(window.webpackJsonp=window.webpackJsonp||[]).push([[141],{1188:function(e,t,s){e.exports=s.p+"assets/img/Mysql-4.6e40f794.png"},1189:function(e,t,s){e.exports=s.p+"assets/img/Mysql-3.418885de.png"},1714:function(e,t,s){"use strict";s.r(t);var r=s(42),a=Object(r.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"mysql-5-7-21-移植指南-openeuler-20-03-lts-sp1"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#mysql-5-7-21-移植指南-openeuler-20-03-lts-sp1"}},[e._v("#")]),e._v(" MySQL 5.7.21 移植指南（openEuler 20.03 LTS SP1）")]),e._v(" "),r("h2",{attrs:{id:"_1-简要介绍"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-简要介绍"}},[e._v("#")]),e._v(" 1.简要介绍")]),e._v(" "),r("p",[e._v("本文主要用于指导在openEuler 20.03 sp1 操作系统上部署mysql数据库。")]),e._v(" "),r("p",[e._v("MySQL 是一款安全、跨平台、高效的，并与 PHP、Java 等主流编程语言紧密结合的数据库系统。\n本案例使用x86_64架构虚拟机，通过评估工具x2openEuler评估MySQL 5.7.21软件移植到openEuler操作系统的兼容性，再实施数据搬迁。")]),e._v(" "),r("p",[e._v("建议使用版本为MySQL 5.7.21。")]),e._v(" "),r("blockquote",[r("p",[e._v("说明:\n本文档适用于MySQL 5.7.21，其他版本的MySQL移植步骤也可参考本文档。")])]),e._v(" "),r("h2",{attrs:{id:"_2-案例环境"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-案例环境"}},[e._v("#")]),e._v(" 2.案例环境")]),e._v(" "),r("p",[e._v("服务器")]),e._v(" "),r("table",[r("thead",[r("tr",[r("th",[e._v("项目")]),e._v(" "),r("th",[e._v("说明")])])]),e._v(" "),r("tbody",[r("tr",[r("td",[e._v("服务器")]),e._v(" "),r("td",[e._v("TaiShan 200服务器")])]),e._v(" "),r("tr",[r("td",[e._v("CPU")]),e._v(" "),r("td",[e._v("华为鲲鹏920处理器")])]),e._v(" "),r("tr",[r("td",[e._v("Raid卡")]),e._v(" "),r("td",[e._v("SAS3508")])]),e._v(" "),r("tr",[r("td",[e._v("网络卡")]),e._v(" "),r("td",[e._v("Mellanox SP333")])]),e._v(" "),r("tr",[r("td"),e._v(" "),r("td",[e._v("TM210")])]),e._v(" "),r("tr",[r("td"),e._v(" "),r("td",[e._v("TM280")])]),e._v(" "),r("tr",[r("td",[e._v("磁盘容量")]),e._v(" "),r("td",[e._v("500GB以上")])])])]),e._v(" "),r("p",[e._v("OS")]),e._v(" "),r("table",[r("thead",[r("tr",[r("th",[e._v("软件")]),e._v(" "),r("th",[e._v("版本")]),e._v(" "),r("th",[e._v("备注")])])]),e._v(" "),r("tbody",[r("tr",[r("td",[e._v("OS")]),e._v(" "),r("td",[e._v("Centos 7.6.1810")]),e._v(" "),r("td",[e._v("当前mysql集群服务器")])]),e._v(" "),r("tr",[r("td",[e._v("OS")]),e._v(" "),r("td",[e._v("openEuler 20.03 SP1")]),e._v(" "),r("td",[e._v("迁移目标服务器")])])])]),e._v(" "),r("p",[e._v("软件包")]),e._v(" "),r("table",[r("thead",[r("tr",[r("th",[e._v("软件")]),e._v(" "),r("th",[e._v("版本")])])]),e._v(" "),r("tbody",[r("tr",[r("td",[e._v("mysql5")]),e._v(" "),r("td",[e._v("5.7.21")])]),e._v(" "),r("tr",[r("td",[e._v("mysql5-common")]),e._v(" "),r("td",[e._v("5.7.21")])]),e._v(" "),r("tr",[r("td",[e._v("mysql5-embedded")]),e._v(" "),r("td",[e._v("5.7.21")])]),e._v(" "),r("tr",[r("td",[e._v("mysql5-embedded-devel")]),e._v(" "),r("td",[e._v("5.7.21")])]),e._v(" "),r("tr",[r("td",[e._v("mysql5-errmsg")]),e._v(" "),r("td",[e._v("5.7.21")])]),e._v(" "),r("tr",[r("td",[e._v("mysql5-libs")]),e._v(" "),r("td",[e._v("5.7.21")])]),e._v(" "),r("tr",[r("td",[e._v("mysql5-server")]),e._v(" "),r("td",[e._v("5.7.21")])]),e._v(" "),r("tr",[r("td",[e._v("mysql5-test")]),e._v(" "),r("td",[e._v("5.7.21")])])])]),e._v(" "),r("h2",{attrs:{id:"_3-软件兼容性评估"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-软件兼容性评估"}},[e._v("#")]),e._v(" 3.软件兼容性评估")]),e._v(" "),r("p",[e._v("openEuler社区提供了 "),r("a",{attrs:{href:"https://repo.oepkgs.net/openEuler/rpm/openEuler-20.03-LTS-SP1/extras-tgz/noarch/",target:"_blank",rel:"noopener noreferrer"}},[e._v("x2openEuler 工具"),r("OutboundLink")],1),e._v(" ，针对已经编译好的二进制程序，进行主要完成软件包、接口级评估，明确应用软件是否需要移植适配，是否有依赖的软件包待引入；同时评估软件调用的接口原型在两个系统中是否有差异。")]),e._v(" "),r("p",[e._v("注：已经编译好的二进制程序，难以保障全部兼容新OS，严重时会引发才内存风险，往往这种问题很难通过验证的方式识别出来，迁移前针对软件兼容性评估尤为重要。")]),e._v(" "),r("h4",{attrs:{id:"_3-1获取mysql的rpm包并解压到-opt-mysql目录下"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-1获取mysql的rpm包并解压到-opt-mysql目录下"}},[e._v("#")]),e._v(" 3.1获取mysql的RPM包并解压到/opt/mysql目录下")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("wget -P /opt https://downloads.mysql.com/archives/get/p/23/file/mysql-5.7.21-1.el7.x86_64.rpm-bundle.tar\n")])])]),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("cd /opt/\nmkdir mysql\ntar -xf mysql-5.7.21-1.el7.x86_64.rpm-bundle.tar -C mysql\n")])])]),r("h4",{attrs:{id:"_3-2下载工具到-opt-mysql"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-2下载工具到-opt-mysql"}},[e._v("#")]),e._v(" 3.2下载工具到/opt/mysql")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("cd /opt/mysql\nwget https://repo.oepkgs.net/openEuler/rpm/openEuler-20.03-LTS-SP1/extras-tgz/noarch/x2openEuler-1.0-1.noarch.rpm\n\n用户指南：\nhttps://gitee.com/openeuler/docs/blob/stable2-20.03_LTS_SP1/docs/zh/docs/thirdparty_migration/x2openEuleruseguide.md\n")])])]),r("h4",{attrs:{id:"_3-3部署工具"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-3部署工具"}},[e._v("#")]),e._v(" 3.3部署工具")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("cd /opt/mysql\nrpm -ivh x2openEuler-1.0-1.noarch.rpm\n")])])]),r("blockquote",[r("p",[e._v("注意：安装rpm时需要使用root用户，且目前需要网络（用于下载安装依赖）\n注意：根据提示安装依赖包如bzip2-devel等")])]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("su x2openEuler\nx2openEuler redis-db -init\n")])])]),r("blockquote",[r("p",[e._v("依次录入redis数据库的ip:127.0.0.1\n端口：6379\n数据库索引号（0-16）：0\n密码（工具会对密码加密处理）：如果redis密码没有设置或者为空时，直接回车即可")])]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("x2openEuler init source_centos7.6-openEuler20.03-LTS-SP1.tar.gz\n")])])]),r("blockquote",[r("p",[e._v("备注：x2openEuler使用rpm安装完成后会在/opt/x2openEuler目录下带有source_centos7.6-openEuler20.03-LTS-SP1.tar.gz这个默认资源包\n需要支持centos8.2到openEuler20.03-LTS-SP1的评估，则需获取对应的静态资源包导入，如对应的资源包为source_centos8.2-openEuler20.03-LTS-SP1.tar.gz，导入此包命令："),r("code",[e._v("x2openEuler init source_centos8.2-openEuler20.03-LTS-SP1.tar.gz")]),e._v("，请示情况选择对应的资源包")])]),e._v(" "),r("h4",{attrs:{id:"_3-4扫描mysql"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-4扫描mysql"}},[e._v("#")]),e._v(" 3.4扫描mysql")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("x2openEuler scan /opt/mysql/\n注意要分析的移植文件需要有能够让x2openEuler用户可以读取的权限\n扫描完成后会在/opt/x2openEuler/output目录生成html格式的报告\n")])])]),r("h2",{attrs:{id:"_4-评估结果分析"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-评估结果分析"}},[e._v("#")]),e._v(" 4.评估结果分析")]),e._v(" "),r("p",[e._v("软件兼容性评估报告分三块内容展示软件兼容性，分别是依赖包兼容性、C/C++接口兼容性、java接口兼容性，依赖包兼容性反映了软件包安装过程中的直接依赖，非100%表明无法正确安装；接口兼容性反映的是单个软件运行过程中对其他软件包、动态库或系统接口的调用变化，非100%表明在某个功能调用时可能会触发异常，未调用到时可能表现正常；部分结果建议人工复核，最终软件包使用建优先级建议 openEuler已移植包>openEuler上人工重编译包>centos软件包。")]),e._v(" "),r("h4",{attrs:{id:"_4-1报告分析"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-1报告分析"}},[e._v("#")]),e._v(" 4.1报告分析")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("打开html报告，逐行分析，得出结论：在openEuler上直接使用centos的mysql包存在风险，风险如下：\n1个待确认接口表明mysql系列软件包会调用到libaio.so.1.0.1，其函数参数数量从4变为5，直接影响了功能，在某个功能调用时可能会触发异常；\n\n另外，报告显示需要确认3个依赖软件包，经过人工确认属于mysql系列包自闭环的依赖，故软件包安装无影响\n")])])]),r("img",{attrs:{src:s(1188)}}),e._v(" "),r("img",{attrs:{src:s(1189)}}),e._v(" "),r("h4",{attrs:{id:"_4-2分析结果建议"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-2分析结果建议"}},[e._v("#")]),e._v(" 4.2分析结果建议")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("建议：由于函数调用风险，建议直接使用在openEuler官方编译移植过的mysql-5.7.21系列软件包\nhttps://repo.openeuler.org/openEuler-20.03-LTS-SP1/everything/x86_64/Packages/mysql5-5.7.21-3.oe1.x86_64.rpm\nhttps://repo.openeuler.org/openEuler-20.03-LTS-SP1/everything/x86_64/Packages/mariadb-common-10.3.9-9.oe1.x86_64.rpm\nhttps://repo.openeuler.org/openEuler-20.03-LTS-SP1/everything/x86_64/Packages/mysql5-common-5.7.21-3.oe1.x86_64.rpm\nhttps://repo.openeuler.org/openEuler-20.03-LTS-SP1/everything/x86_64/Packages/mysql5-server-5.7.21-3.oe1.x86_64.rpm\nhttps://repo.openeuler.org/openEuler-20.03-LTS-SP1/everything/x86_64/Packages/mysql5-errmsg-5.7.21-3.oe1.x86_64.rpm\nhttps://repo.openeuler.org/openEuler-20.03-LTS-SP1/everything/x86_64/Packages/mecab-0.996-2.oe1.x86_64.rpm\n")])])]),r("h2",{attrs:{id:"_5-安装数据库mysql"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-安装数据库mysql"}},[e._v("#")]),e._v(" 5.安装数据库mysql")]),e._v(" "),r("h4",{attrs:{id:"_5-1安装mysql并配置密码"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-1安装mysql并配置密码"}},[e._v("#")]),e._v(" 5.1安装mysql并配置密码")]),e._v(" "),r("p",[r("strong",[e._v("1）安装mariadb及mysql相关服务。")])]),e._v(" "),r("p",[e._v("rpm -ivh mysql5-5.7.21-3.oe1.x86_64.rpm mariadb-common-10.3.9-9.oe1.x86_64.rpm mysql5-common-5.7.21-3.oe1.x86_64.rpm mysql5-server-5.7.21-3.oe1.x86_64.rpm mecab-0.996-2.oe1.x86_64.rpm mysql5-errmsg-5.7.21-3.oe1.x86_64.rpm")]),e._v(" "),r("p",[r("strong",[e._v("2） 启动mysql。")])]),e._v(" "),r("p",[e._v("systemctl start mysqld")]),e._v(" "),r("p",[r("strong",[e._v("3）mysql状态查询。")])]),e._v(" "),r("p",[e._v("systemctl status mysqld")]),e._v(" "),r("p",[e._v("状态为running则启动成功：")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("root@vm-2p32g.2288hv5-2s44p-384g--b5-0 ~# systemctl status mysqld\n\n● mysqld.service - MySQL 5.7 database server\n\n  Loaded: loaded (/usr/lib/systemd/system/mysqld.service; disabled; vendor preset: disabled)\n\n  Active: active (running) since Thu 2021-09-09 10:23:25 CST; 1 day 4h ago\n\n Process: 103715 ExecStartPre=/usr/libexec/mysql-check-socket (code=exited, status=0/SUCCESS)\n\n Process: 103738 ExecStartPre=/usr/libexec/mysql-prepare-db-dir mysqld.service (code=exited, sta>\n\n Process: 103773 ExecStart=/usr/libexec/mysqld --daemonize --basedir=/usr --pid-file=/run/mysqld>\n\n Process: 103803 ExecStartPost=/usr/libexec/mysql-check-upgrade (code=exited, status=0/SUCCESS)\n\n Main PID: 103775 (mysqld)\n\n  Tasks: 37\n\n  Memory: 188.4M\n\n  CGroup: /system.slice/mysqld.service\n\n​      └─103775 /usr/libexec/mysqld --daemonize --basedir=/usr --pid-file=/run/mysqld/mysqld.\n")])])]),r("p",[r("strong",[e._v("4） 登录并修改默认密码。")])]),e._v(" "),r("p",[e._v("mysql -uroot -p")]),e._v(" "),r("p",[e._v("a.     默认没有密码，按回车即可登录。")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("root@vm-2p32g.2288hv5-2s44p-384g--b5-0 /# mysql -uroot -p\n\nEnter password: \n\nWelcome to the MySQL monitor. Commands end with ; or \\g.\n\nYour MySQL connection id is 2\n\nServer version: 5.7.21 MySQL Community Server (GPL)\n\n \nCopyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.\n\n \nOracle is a registered trademark of Oracle Corporation and/or its\n\naffiliates. Other names may be trademarks of their respective\n\nowners.\n\n\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nmysql>\n")])])]),r("p",[e._v("b.     设置密码。")]),e._v(" "),r("p",[e._v("alter user 'user'@'localhost' identified by 'passward';")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("mysql> alter user 'root'@'localhost' identified by '123456';\n\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> flush privileges;\n\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql>\n")])])]),r("blockquote",[r("p",[r("strong",[e._v("flush privileges")]),e._v("必须执行，否则设置不生效。")])]),e._v(" "),r("p",[r("strong",[e._v("5） 验证密码。")])]),e._v(" "),r("p",[e._v("退出后重新登录，查看密码是否修改成功。")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("root@vm-2p32g.2288hv5-2s44p-384g--b5-0 /# mysql -uroot -p\n\nEnter password: \n\nWelcome to the MySQL monitor. Commands end with ; or \\g.\n\nYour MySQL connection id is 3\n\nServer version: 5.7.21 MySQL Community Server (GPL)\n\n\nCopyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.\n\n \nOracle is a registered trademark of Oracle Corporation and/or its\n\naffiliates. Other names may be trademarks of their respective\n\nowners.\n\n\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\n\nmysql>\n")])])])])}),[],!1,null,null,null);t.default=a.exports}}]);