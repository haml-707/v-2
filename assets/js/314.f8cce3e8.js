(window.webpackJsonp=window.webpackJsonp||[]).push([[314],{1754:function(r,t,e){"use strict";e.r(t);var a=e(42),n=Object(a.a)({},(function(){var r=this,t=r.$createElement,e=r._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":r.$parent.slotKey}},[e("p",[r._v("社区核心参与者："),e("a",{attrs:{href:"https://github.com/martin-g",target:"_blank",rel:"noopener noreferrer"}},[r._v("Martin Grigorov"),e("OutboundLink")],1),r._v("、"),e("a",{attrs:{href:"https://www.linkedin.com/in/mikerumph/",target:"_blank",rel:"noopener noreferrer"}},[r._v("Michael Rumph"),e("OutboundLink")],1),r._v("、"),e("a",{attrs:{href:"https://github.com/wangxiyuan",target:"_blank",rel:"noopener noreferrer"}},[r._v("王玺源"),e("OutboundLink")],1)]),r._v(" "),e("h1",{attrs:{id:"背景"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[r._v("#")]),r._v(" 背景")]),r._v(" "),e("p",[r._v("开源界中Web服务众多,但其中很多软件对ARM64的支持并不理想。或是没有官方CI测试保证代码质量，或是在ARM64上的性能明显差于X86_64，甚至有的服务根本无法在ARM上运行。为了完善Web领域的ARM64生态，我们参与了主流的几个开源社区，旨在推动Web on ARM64。以下是我们近期的一些进展，以供大家参考。")]),r._v(" "),e("h1",{attrs:{id:"概述"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[r._v("#")]),r._v(" 概述")]),r._v(" "),e("p",[r._v("我们目前参与了主流的共9个Web相关项目。如下所示")]),r._v(" "),e("table",[e("thead",[e("tr",[e("th",[r._v("项目")]),r._v(" "),e("th",[r._v("主要语言")])])]),r._v(" "),e("tbody",[e("tr",[e("td",[r._v("Apache Httpd Server")]),r._v(" "),e("td",[r._v("C")])]),r._v(" "),e("tr",[e("td",[r._v("Apache Tomcat")]),r._v(" "),e("td",[r._v("Java")])]),r._v(" "),e("tr",[e("td",[r._v("Memcached")]),r._v(" "),e("td",[r._v("C")])]),r._v(" "),e("tr",[e("td",[r._v("Nginx")]),r._v(" "),e("td",[r._v("C")])]),r._v(" "),e("tr",[e("td",[r._v("Lighttpd")]),r._v(" "),e("td",[r._v("C")])]),r._v(" "),e("tr",[e("td",[r._v("JBoss/WildFly")]),r._v(" "),e("td",[r._v("Java")])]),r._v(" "),e("tr",[e("td",[r._v("HAProxy")]),r._v(" "),e("td",[r._v("C")])]),r._v(" "),e("tr",[e("td",[r._v("Squid")]),r._v(" "),e("td",[r._v("C++")])]),r._v(" "),e("tr",[e("td",[r._v("Varnish Cache")]),r._v(" "),e("td",[r._v("C")])])])]),r._v(" "),e("p",[r._v("针对这些项目，我们按照以下三个方面循序渐进的推动中:")]),r._v(" "),e("ol",[e("li",[r._v("能不能在ARM上运行")]),r._v(" "),e("li",[r._v("如何稳定在ARM上运行")]),r._v(" "),e("li",[r._v("怎么更好的在ARM上运行")])]),r._v(" "),e("h1",{attrs:{id:"能不能在arm上运行"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#能不能在arm上运行"}},[r._v("#")]),r._v(" 能不能在ARM上运行")]),r._v(" "),e("p",[r._v("我们可以看到这9大项目主要由Java和C/C++编写。")]),r._v(" "),e("p",[r._v("首先，像Python、Java这种自带runtime的语言天生就是跨平台的。这样的项目在ARM64平台上至少可以保证程序的可运行。")]),r._v(" "),e("p",[r._v("而C/C++项目则需要先编译成ARM64平台的目标可执行文件。这样的项目则需要先进行编译测试。")]),r._v(" "),e("p",[r._v("经过我们的测试，这9个Web项目都可以在ARM64上成功编译并运行。")]),r._v(" "),e("h1",{attrs:{id:"如何稳定在arm上运行"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#如何稳定在arm上运行"}},[r._v("#")]),r._v(" 如何稳定在ARM上运行")]),r._v(" "),e("p",[r._v("所谓稳定，包含两个方面：")]),r._v(" "),e("ol",[e("li",[r._v("软件在ARM64上是否和在X86_64上行为一致？")]),r._v(" "),e("li",[r._v("随着代码更新迭代，软件在ARM64上是否持续可用？")])]),r._v(" "),e("h2",{attrs:{id:"行为一致"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#行为一致"}},[r._v("#")]),r._v(" 行为一致")]),r._v(" "),e("p",[r._v("我们常遇到两类行为一致的问题：")]),r._v(" "),e("ol",[e("li",[r._v("同样的代码，不同的结果")]),r._v(" "),e("li",[r._v("同样的功能，不同的支持")])]),r._v(" "),e("p",[r._v("很遗憾，由于架构不同、底层实现不同等原因，很多软件的某些行为在X86_64和ARM64上的行为并不一致。")]),r._v(" "),e("p",[r._v("例如，之前的"),e("a",{attrs:{href:"https://kunpengcompute.github.io/2020/04/08/arm-you-hua-he-java-math-ku-you-guan-de-na-xie-keng/",target:"_blank",rel:"noopener noreferrer"}},[r._v("文章"),e("OutboundLink")],1),r._v("提到的Java中Math计算结果的差异。")]),r._v(" "),e("p",[r._v("又或者某些功能依赖独有的平台特性或者特殊的第三方库，导致在X86_64上可以运行的功能，在ARM64上却执行失败。")]),r._v(" "),e("p",[r._v("例如我们发现WildFly官方发布的源码包中缺少了个别ARM64平台的"),e("code",[r._v(".so")]),r._v("文件，这就导致个别调用"),e("code",[r._v(".so")]),r._v("的功能不可用。")]),r._v(" "),e("p",[r._v("针对这种问题，我们需要打开代码逐个分析、逐个修复。保证所有测试在ARM64上全部通过。")]),r._v(" "),e("h2",{attrs:{id:"持续可用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#持续可用"}},[r._v("#")]),r._v(" 持续可用")]),r._v(" "),e("p",[r._v("CI/CD是保证软件持续可用的重要方法。主流软件的CI系统都有X86_64平台的测试。而ARM64平台的少之又少。")]),r._v(" "),e("p",[r._v("针对这个问题，我们推动了这9个项目的ARM CI支持。除Lighttpd还在推动中以外，其他8个项目目前都已支持了ARM CI。甚至其中4个项目已经官方声明了ARM64的支持（详见附录）。")]),r._v(" "),e("p",[r._v("其中Httpd、Tomcat、Memcached、HAProxy和Varnish Cache通过Travis CI支持了ARM64测试。Nginx使用内部CI，对外不可见。Squid使用自己的树莓派。而JBOSS使用了我们捐献的基于Kunpeng 920的ARM虚拟机。同时我们也计划捐献同样的测试机到Lighttpd社区中。")]),r._v(" "),e("p",[r._v("随着ARM CI的落地，我们将持续保证ARM CI的稳定。我们相信在不久的将来，这9大核心Web项目都会官方声明ARM64的支持，并满足用户在ARM64上稳定、高效使用Web服务的需求。")]),r._v(" "),e("h1",{attrs:{id:"怎么更好的在arm上运行"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#怎么更好的在arm上运行"}},[r._v("#")]),r._v(" 怎么更好的在ARM上运行")]),r._v(" "),e("p",[r._v("我们不仅希望软件在ARM64上能用，还在不断探索如何让软件在ARM64上用的好。其中"),e("strong",[r._v("性能优化")]),r._v("是重中之重，也是我们未来一段时间的主要投入点。")]),r._v(" "),e("p",[r._v("例如，有些软件只实现了X86_64的汇编实现，但缺少ARM64的汇编代码。")]),r._v(" "),e("p",[r._v("又或者有些在X86_64上纯软实现的功能，可以在ARM64上通过下沉至硬编码的方式提高性能。")]),r._v(" "),e("p",[r._v("甚至还可以考虑如何最大化利用ARM64的多核优势，或规避ARM64的锁劣势等等。")]),r._v(" "),e("p",[r._v("关于性能优化的内容，我们将在以后的文章中针对不同的软件一一细说。敬请期待。")]),r._v(" "),e("h1",{attrs:{id:"操作系统支持"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#操作系统支持"}},[r._v("#")]),r._v(" 操作系统支持")]),r._v(" "),e("p",[r._v("一般情况下，开源软件很少自己分发不同操作系统的安装包。以我们参与的9个Web服务为例，只有Nginx提供了Ubuntu的安装包，Varnish Cache只提供了编译好的可执行文件，而其他7个服务仅仅提供了源码。")]),r._v(" "),e("p",[r._v("针对Nginx这种官方提供安装包的项目，我们希望它能提供更多操作系统的安装包，在我们的推动下，Nginx社区已表示下一步会推出CentOS和Alpine的安装包。OpenEuler也在我们的规划中。敬请期待。")]),r._v(" "),e("p",[r._v("大多数只提供源码或可执行文件的服务，针对这种情况，各个操作系统需要自行打包、分发。以OpenEuler为例，可以看到在官方"),e("a",{attrs:{href:"https://repo.openeuler.org",target:"_blank",rel:"noopener noreferrer"}},[r._v("Repo"),e("OutboundLink")],1),r._v("中已经支持了部分Web服务aarch64安装包。丰富的安装包支持也是操作系统易用性的重要体现。我们相信随着ARM64软件生态的不断丰富，OpenEuler的仓库也会不断充实。")]),r._v(" "),e("h1",{attrs:{id:"附录"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#附录"}},[r._v("#")]),r._v(" 附录")]),r._v(" "),e("p",[r._v("最后附上我们参与Web社区的总览表格及相关链接，感兴趣的同学可以进一步详读，有任何问题，欢迎留言。")]),r._v(" "),e("table",[e("thead",[e("tr",[e("th"),r._v(" "),e("th",[r._v("Official arm64 CI")]),r._v(" "),e("th",[r._v("CI tool")]),r._v(" "),e("th",[r._v("Package in Downloads")]),r._v(" "),e("th",[r._v("Official ARM support")])])]),r._v(" "),e("tbody",[e("tr",[e("td",[e("a",{attrs:{href:"https://tomcat.apache.org/",target:"_blank",rel:"noopener noreferrer"}},[r._v("Apache Tomcat"),e("OutboundLink")],1)]),r._v(" "),e("td",[e("a",{attrs:{href:"https://github.com/apache/tomcat/commit/f386fbb4abaa3fe8f3b3df1da7d14f756c729e2e",target:"_blank",rel:"noopener noreferrer"}},[r._v("YES"),e("OutboundLink")],1)]),r._v(" "),e("td",[e("a",{attrs:{href:"https://github.com/apache/tomcat/blob/master/.travis.yml",target:"_blank",rel:"noopener noreferrer"}},[r._v("TravisCI"),e("OutboundLink")],1)]),r._v(" "),e("td",[e("a",{attrs:{href:"https://tomcat.apache.org/download-90.cgi",target:"_blank",rel:"noopener noreferrer"}},[r._v("Binary"),e("OutboundLink")],1)]),r._v(" "),e("td",[r._v("WIP(work in progress)")])]),r._v(" "),e("tr",[e("td",[e("a",{attrs:{href:"https://memcached.org/",target:"_blank",rel:"noopener noreferrer"}},[r._v("Memcached"),e("OutboundLink")],1)]),r._v(" "),e("td",[e("a",{attrs:{href:"https://github.com/memcached/memcached/pull/593",target:"_blank",rel:"noopener noreferrer"}},[r._v("YES"),e("OutboundLink")],1)]),r._v(" "),e("td",[r._v("1. "),e("a",{attrs:{href:"http://build.memcached.org:8010/",target:"_blank",rel:"noopener noreferrer"}},[r._v("BuildBot"),e("OutboundLink")],1),r._v(" 2. "),e("a",{attrs:{href:"https://github.com/memcached/memcached/blob/master/.travis.yml",target:"_blank",rel:"noopener noreferrer"}},[r._v("TravisCI"),e("OutboundLink")],1)]),r._v(" "),e("td",[e("a",{attrs:{href:"https://memcached.org/downloads",target:"_blank",rel:"noopener noreferrer"}},[r._v("Source Code"),e("OutboundLink")],1)]),r._v(" "),e("td",[e("a",{attrs:{href:"https://github.com/memcached/memcached/wiki/Hardware",target:"_blank",rel:"noopener noreferrer"}},[r._v("YES"),e("OutboundLink")],1)])]),r._v(" "),e("tr",[e("td",[e("a",{attrs:{href:"https://httpd.apache.org/",target:"_blank",rel:"noopener noreferrer"}},[r._v("Apache httpd"),e("OutboundLink")],1)]),r._v(" "),e("td",[e("a",{attrs:{href:"https://markmail.org/message/ajm3eouaqfhm22ox",target:"_blank",rel:"noopener noreferrer"}},[r._v("YES"),e("OutboundLink")],1)]),r._v(" "),e("td",[e("a",{attrs:{href:"https://github.com/apache/httpd/blob/trunk/.travis.yml",target:"_blank",rel:"noopener noreferrer"}},[r._v("TravisCI"),e("OutboundLink")],1)]),r._v(" "),e("td",[e("a",{attrs:{href:"http://httpd.apache.org/download.cgi",target:"_blank",rel:"noopener noreferrer"}},[r._v("Source Code"),e("OutboundLink")],1)]),r._v(" "),e("td",[e("a",{attrs:{href:"https://github.com/apache/httpd/blob/2.4.x/CHANGES#L17-L20",target:"_blank",rel:"noopener noreferrer"}},[r._v("YES"),e("OutboundLink")],1)])]),r._v(" "),e("tr",[e("td",[e("a",{attrs:{href:"https://nginx.org/",target:"_blank",rel:"noopener noreferrer"}},[r._v("NGINX"),e("OutboundLink")],1)]),r._v(" "),e("td",[e("a",{attrs:{href:"https://mailman.nginx.org/pipermail/nginx-devel/2020-January/012943.html",target:"_blank",rel:"noopener noreferrer"}},[r._v("YES"),e("OutboundLink")],1)]),r._v(" "),e("td",[r._v("Internal")]),r._v(" "),e("td",[r._v("Only for "),e("a",{attrs:{href:"https://nginx.org/en/linux_packages.html",target:"_blank",rel:"noopener noreferrer"}},[r._v("Ubuntu"),e("OutboundLink")],1),r._v(" LTSs")]),r._v(" "),e("td",[e("a",{attrs:{href:"https://nginx.org/en/linux_packages.html#Ubuntu",target:"_blank",rel:"noopener noreferrer"}},[r._v("YES"),e("OutboundLink")],1)])]),r._v(" "),e("tr",[e("td",[e("a",{attrs:{href:"https://www.lighttpd.net/",target:"_blank",rel:"noopener noreferrer"}},[r._v("Lighttpd"),e("OutboundLink")],1)]),r._v(" "),e("td",[r._v("NO")]),r._v(" "),e("td",[e("a",{attrs:{href:"https://ci.lighttpd.net/view/lighttpd1.4/job/lighttpd1.4/",target:"_blank",rel:"noopener noreferrer"}},[r._v("Jenkins"),e("OutboundLink")],1)]),r._v(" "),e("td",[e("a",{attrs:{href:"https://www.lighttpd.net/download/",target:"_blank",rel:"noopener noreferrer"}},[r._v("Source Code"),e("OutboundLink")],1)]),r._v(" "),e("td",[r._v("NO")])]),r._v(" "),e("tr",[e("td",[e("a",{attrs:{href:"https://www.wildfly.org/",target:"_blank",rel:"noopener noreferrer"}},[r._v("JBoss/Wildfly"),e("OutboundLink")],1)]),r._v(" "),e("td",[e("a",{attrs:{href:"https://ci.wildfly.org/viewType.html?buildTypeId=WF_MasterLinuxArm64OpenJ911",target:"_blank",rel:"noopener noreferrer"}},[r._v("YES"),e("OutboundLink")],1)]),r._v(" "),e("td",[e("a",{attrs:{href:"https://ci.wildfly.org/",target:"_blank",rel:"noopener noreferrer"}},[r._v("TeamCity"),e("OutboundLink")],1)]),r._v(" "),e("td",[e("a",{attrs:{href:"https://wildfly.org/downloads/",target:"_blank",rel:"noopener noreferrer"}},[r._v("Source Code"),e("OutboundLink")],1)]),r._v(" "),e("td",[r._v("NO")])]),r._v(" "),e("tr",[e("td",[e("a",{attrs:{href:"https://www.haproxy.org/",target:"_blank",rel:"noopener noreferrer"}},[r._v("HAProxy"),e("OutboundLink")],1)]),r._v(" "),e("td",[e("a",{attrs:{href:"https://github.com/haproxy/haproxy/commit/9bf2a1be89a6eaddb00f07b9d069a9a16c24c037",target:"_blank",rel:"noopener noreferrer"}},[r._v("YES"),e("OutboundLink")],1)]),r._v(" "),e("td",[r._v("1. "),e("a",{attrs:{href:"https://cirrus-ci.com/github/haproxy/haproxy",target:"_blank",rel:"noopener noreferrer"}},[r._v("CirrusCI"),e("OutboundLink")],1),r._v(" "),e("br"),r._v(" 2. "),e("a",{attrs:{href:"https://github.com/haproxy/haproxy/blob/master/.travis.yml",target:"_blank",rel:"noopener noreferrer"}},[r._v("TravisCI"),e("OutboundLink")],1)]),r._v(" "),e("td",[e("a",{attrs:{href:"http://www.haproxy.org/",target:"_blank",rel:"noopener noreferrer"}},[r._v("Source Code"),e("OutboundLink")],1)]),r._v(" "),e("td",[e("a",{attrs:{href:"https://www.haproxy.org/#plat",target:"_blank",rel:"noopener noreferrer"}},[r._v("YES"),e("OutboundLink")],1)])]),r._v(" "),e("tr",[e("td",[e("a",{attrs:{href:"http://www.squid-cache.org/",target:"_blank",rel:"noopener noreferrer"}},[r._v("Squid"),e("OutboundLink")],1)]),r._v(" "),e("td",[e("a",{attrs:{href:"http://build.squid-cache.org/computer/arm64-rpi/",target:"_blank",rel:"noopener noreferrer"}},[r._v("YES"),e("OutboundLink")],1)]),r._v(" "),e("td",[e("a",{attrs:{href:"http://build.squid-cache.org/",target:"_blank",rel:"noopener noreferrer"}},[r._v("Jenkins"),e("OutboundLink")],1)]),r._v(" "),e("td",[e("a",{attrs:{href:"http://squid-cache.org/Versions/",target:"_blank",rel:"noopener noreferrer"}},[r._v("Source Code"),e("OutboundLink")],1)]),r._v(" "),e("td",[r._v("NO")])]),r._v(" "),e("tr",[e("td",[e("a",{attrs:{href:"https://github.com/varnishcache/varnish-cache/",target:"_blank",rel:"noopener noreferrer"}},[r._v("Varnish Cache"),e("OutboundLink")],1)]),r._v(" "),e("td",[e("a",{attrs:{href:"https://github.com/varnishcache/varnish-cache/pull/3195",target:"_blank",rel:"noopener noreferrer"}},[r._v("YES"),e("OutboundLink")],1)]),r._v(" "),e("td",[e("a",{attrs:{href:"https://github.com/varnishcache/varnish-cache/blob/master/.travis.yml",target:"_blank",rel:"noopener noreferrer"}},[r._v("Travis"),e("OutboundLink")],1)]),r._v(" "),e("td",[r._v("1. "),e("a",{attrs:{href:"https://varnish-cache.org/releases/index.html",target:"_blank",rel:"noopener noreferrer"}},[r._v("Source Code"),e("OutboundLink")],1),r._v(" "),e("br"),r._v(" 2. "),e("a",{attrs:{href:"https://packagecloud.io/varnishcache",target:"_blank",rel:"noopener noreferrer"}},[r._v("Package"),e("OutboundLink")],1)]),r._v(" "),e("td",[r._v("NO")])])])])])}),[],!1,null,null,null);t.default=n.exports}}]);