<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>IOMMU和Arm SMMU介绍</title>
    <meta name="generator" content="VuePress 1.5.4">
    <link rel="icon" href="/favicon.ico">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
  <script src="/js/analytics.js"></script>
  <meta name="keywords" content="openEuler, 操作系统, 开放, 生态, 开源, Linux 开源, OS, open, ecosystem, open source, Linux open source">
  <meta name="baidu-site-verification" content="code-EWzbQRssNU">
    <meta name="description" content="openEuler 是一个开源、免费的 Linux 发行版平台，将通过开放的社区形式与全球的开发者共同构建一个开放、多元和架构包容的软件生态体系。同时，openEuler 也是一个创新的平台，鼓励任何人在该平台上提出新想法、开拓新思路、实践新方案。">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="keywords" content="openEuler, 操作系统, 开放, 生态, 开源, Linux 开源, OS, open, ecosystem, open source, Linux open source">
    <meta name="baidu-site-verification" content="code-EWzbQRssNU">
    <link rel="preload" href="/assets/css/0.styles.0df284ed.css" as="style"><link rel="preload" href="/assets/js/app.cdfb7ee7.js" as="script"><link rel="preload" href="/assets/js/14.8a38dea1.js" as="script"><link rel="preload" href="/assets/js/310.c41f294a.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.0df284ed.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="euler-app" data-v-34596062><div class="nav-fill " data-v-fe04bb58 data-v-34596062><div class="nav-wrapper" data-v-fe04bb58><div class="nav-bar" data-v-fe04bb58><img src="/openeuler-logo.png" alt class="nav-logo" data-v-fe04bb58> <img src="/openeuler-logo.png" alt class="nav-logo nav-logo-mobile" data-v-fe04bb58> <ul class="nav-menu" data-v-fe04bb58><li data-v-fe04bb58><a class="menu-link" data-v-fe04bb58>下载
                        <span data-v-fe04bb58></span></a> <div class="sub-menu" data-v-fe04bb58><ul class="sig-menu-content" data-v-fe04bb58><li data-v-fe04bb58>
                                ISO
                            </li><li data-v-fe04bb58>
                                镜像仓列表
                            </li></ul> <span class="submenu-arrow" data-v-fe04bb58></span></div></li><li data-v-fe04bb58><a class="menu-link" data-v-fe04bb58>学习
                        <span data-v-fe04bb58></span></a> <div class="sub-menu" data-v-fe04bb58><ul class="sig-menu-content" data-v-fe04bb58><li data-v-fe04bb58>
                                文档
                            </li><li data-v-fe04bb58>
                                慕课
                            </li><li data-v-fe04bb58>
                                实习
                            </li></ul> <span class="submenu-arrow" data-v-fe04bb58></span></div></li><li data-v-fe04bb58><a class="menu-link menu-active" data-v-fe04bb58>互动
                        <span data-v-fe04bb58></span></a> <div class="sub-menu" data-v-fe04bb58><ul class="sig-menu-content" data-v-fe04bb58><li data-v-fe04bb58>
                                新闻
                            </li><li data-v-fe04bb58>
                                博客
                            </li><li data-v-fe04bb58>
                                直播
                            </li><li data-v-fe04bb58>
                                沙龙
                            </li><li data-v-fe04bb58>
                                峰会
                            </li></ul> <span class="submenu-arrow" data-v-fe04bb58></span></div></li><li data-v-fe04bb58><a class="menu-link" data-v-fe04bb58>社区
                        <span data-v-fe04bb58></span></a> <div class="sub-menu" data-v-fe04bb58><ul class="sig-menu-content" data-v-fe04bb58><li data-v-fe04bb58>
                                贡献攻略
                            </li><li data-v-fe04bb58>
                                行为守则
                            </li><li data-v-fe04bb58>
                                邮件列表
                            </li><li data-v-fe04bb58>
                                个人认证
                            </li></ul> <span class="submenu-arrow" data-v-fe04bb58></span></div></li><li data-v-fe04bb58><a class="menu-link" data-v-fe04bb58>SIG
                        <span data-v-fe04bb58></span></a> <div class="sub-menu" data-v-fe04bb58><ul class="sig-menu-content" data-v-fe04bb58><li data-v-fe04bb58>
                                查看SIG
                            </li><li data-v-fe04bb58>
                                申请流程
                            </li><li data-v-fe04bb58>
                                角色说明
                            </li></ul> <span class="submenu-arrow" data-v-fe04bb58></span></div></li><li data-v-fe04bb58><a class="menu-link" data-v-fe04bb58>探索
                        <span data-v-fe04bb58></span></a> <div class="sub-menu" data-v-fe04bb58><ul class="sig-menu-content" data-v-fe04bb58><li data-v-fe04bb58>
                                A-Tune
                            </li><li data-v-fe04bb58>
                                Bisheng JDK
                            </li><li data-v-fe04bb58>
                                iSula
                            </li><li data-v-fe04bb58>
                                secGear
                            </li><li data-v-fe04bb58>
                                StratoVirt
                            </li><li data-v-fe04bb58>
                                Compass-CI
                            </li><li data-v-fe04bb58>
                                Compliance
                            </li><li data-v-fe04bb58>
                                Pkgship
                            </li></ul> <span class="submenu-arrow" data-v-fe04bb58></span></div></li><li data-v-fe04bb58><a class="menu-link" data-v-fe04bb58>支持
                        <span data-v-fe04bb58></span></a> <div class="sub-menu" data-v-fe04bb58><ul class="sig-menu-content" data-v-fe04bb58><li data-v-fe04bb58>
                                漏洞管理
                            </li><li data-v-fe04bb58>
                                安全公告
                            </li><li data-v-fe04bb58>
                                CVE
                            </li><li data-v-fe04bb58>
                                兼容性列表
                            </li><li data-v-fe04bb58>
                                迁移指南
                            </li></ul> <span class="submenu-arrow" data-v-fe04bb58></span></div></li></ul> <ul class="nav-menu-mobile" style="display:none;" data-v-fe04bb58 data-v-fe04bb58><li data-v-fe04bb58><a class="menu-link" data-v-fe04bb58>下载<i class="icon-arrow" data-v-fe04bb58></i></a> <ul class="sub-menu" style="display:none;" data-v-fe04bb58 data-v-fe04bb58><li data-v-fe04bb58>
                                    ISO
                                </li><li data-v-fe04bb58>
                                    镜像仓列表
                                </li></ul></li><li data-v-fe04bb58><a class="menu-link" data-v-fe04bb58>学习<i class="icon-arrow" data-v-fe04bb58></i></a> <ul class="sub-menu" style="display:none;" data-v-fe04bb58 data-v-fe04bb58><li data-v-fe04bb58>
                                    文档
                                </li><li data-v-fe04bb58>
                                    慕课
                                </li><li data-v-fe04bb58>
                                    实习
                                </li></ul></li><li data-v-fe04bb58><a class="menu-link" data-v-fe04bb58>互动<i class="icon-arrow arrow-active" data-v-fe04bb58></i></a> <ul class="sub-menu" data-v-fe04bb58 data-v-fe04bb58><li data-v-fe04bb58>
                                    新闻
                                </li><li data-v-fe04bb58>
                                    博客
                                </li><li data-v-fe04bb58>
                                    直播
                                </li><li data-v-fe04bb58>
                                    沙龙
                                </li><li data-v-fe04bb58>
                                    峰会
                                </li></ul></li><li data-v-fe04bb58><a class="menu-link" data-v-fe04bb58>社区<i class="icon-arrow" data-v-fe04bb58></i></a> <ul class="sub-menu" style="display:none;" data-v-fe04bb58 data-v-fe04bb58><li data-v-fe04bb58>
                                    贡献攻略
                                </li><li data-v-fe04bb58>
                                    行为守则
                                </li><li data-v-fe04bb58>
                                    邮件列表
                                </li><li data-v-fe04bb58>
                                    个人认证
                                </li></ul></li><li data-v-fe04bb58><a class="menu-link" data-v-fe04bb58>SIG<i class="icon-arrow" data-v-fe04bb58></i></a> <ul class="sub-menu" style="display:none;" data-v-fe04bb58 data-v-fe04bb58><li data-v-fe04bb58>
                                    查看SIG
                                </li><li data-v-fe04bb58>
                                    申请流程
                                </li><li data-v-fe04bb58>
                                    角色说明
                                </li></ul></li><li data-v-fe04bb58><a class="menu-link" data-v-fe04bb58>探索<i class="icon-arrow" data-v-fe04bb58></i></a> <ul class="sub-menu" style="display:none;" data-v-fe04bb58 data-v-fe04bb58><li data-v-fe04bb58>
                                    A-Tune
                                </li><li data-v-fe04bb58>
                                    Bisheng JDK
                                </li><li data-v-fe04bb58>
                                    iSula
                                </li><li data-v-fe04bb58>
                                    secGear
                                </li><li data-v-fe04bb58>
                                    StratoVirt
                                </li><li data-v-fe04bb58>
                                    Compass-CI
                                </li><li data-v-fe04bb58>
                                    Compliance
                                </li><li data-v-fe04bb58>
                                    Pkgship
                                </li></ul></li><li data-v-fe04bb58><a class="menu-link" data-v-fe04bb58>支持<i class="icon-arrow" data-v-fe04bb58></i></a> <ul class="sub-menu" style="display:none;" data-v-fe04bb58 data-v-fe04bb58><li data-v-fe04bb58>
                                    漏洞管理
                                </li><li data-v-fe04bb58>
                                    安全公告
                                </li><li data-v-fe04bb58>
                                    CVE
                                </li><li data-v-fe04bb58>
                                    兼容性列表
                                </li><li data-v-fe04bb58>
                                    迁移指南
                                </li></ul></li> <li data-v-fe04bb58><a class="menu-link" data-v-fe04bb58>源码<i class="icon-arrow" data-v-fe04bb58></i></a> <ul class="sub-menu" style="display:none;" data-v-fe04bb58 data-v-fe04bb58><li data-v-fe04bb58>
                                    代码仓
                                </li><li data-v-fe04bb58>
                                    软件包仓
                                </li><li data-v-fe04bb58>
                                    GitHub镜像仓
                                </li></ul></li></ul> <div data-v-fe04bb58></div> <div class="search-mobile" data-v-fe04bb58><div class="el-input el-input--suffix" data-v-fe04bb58><!----><input type="text" autocomplete="off" placeholder="输入内容" class="el-input__inner"><!----><span class="el-input__suffix"><span class="el-input__suffix-inner"><i class="icon-search el-input__icon" data-v-fe04bb58></i><!----><!----><!----><!----></span><!----></span><!----><!----></div></div> <ul class="nav-other" style="display:;" data-v-fe04bb58><li class="lang" data-v-fe04bb58><span class="icon-lang" data-v-fe04bb58></span> <ul data-v-fe04bb58><li class="lang-list" data-v-fe04bb58>
                            中文
                        </li><li data-v-fe04bb58>
                            English
                        </li><li data-v-fe04bb58>
                            Русский
                        </li> <span class="submenu-arrow" data-v-fe04bb58></span></ul></li> <li data-v-fe04bb58><span data-v-fe04bb58>代码</span> <ul data-v-fe04bb58><li data-v-fe04bb58>
                            代码仓
                        </li><li data-v-fe04bb58>
                            软件包仓
                        </li><li data-v-fe04bb58>
                            GitHub镜像仓
                        </li> <span class="submenu-arrow" data-v-fe04bb58></span></ul></li> <li class="search" data-v-fe04bb58><img src="/search.png" alt data-v-fe04bb58></li></ul> <div class="search-input" style="display:none;" data-v-fe04bb58><div class="el-input el-input--small el-input--suffix" data-v-fe04bb58><!----><input type="text" autocomplete="off" placeholder="输入内容" class="el-input__inner"><!----><span class="el-input__suffix"><span class="el-input__suffix-inner"><i class="icon-search el-input__icon" data-v-fe04bb58></i><!----><!----><!----><!----></span><!----></span><!----><!----></div></div> <ul class="nav-other-mobile nav-other" data-v-fe04bb58><li class="lang" data-v-fe04bb58><span class="icon-lang" data-v-fe04bb58></span> <ul data-v-fe04bb58><li class="lang-list" data-v-fe04bb58>
                            中文
                        </li><li data-v-fe04bb58>
                            English
                        </li><li data-v-fe04bb58>
                            Русский
                        </li> <span class="submenu-arrow" data-v-fe04bb58></span></ul></li> <li class="search" data-v-fe04bb58><span class="icon-search" data-v-fe04bb58></span></li> <li class="menu" data-v-fe04bb58><span class="icon-menu" data-v-fe04bb58></span></li></ul></div></div> <!----></div> <!----> <div id="vuepress-theme-blog__post-layout" class="content" data-v-8dab3852 data-v-34596062><div class="blog-link-post" data-v-8dab3852>
        博客\
    </div> <div class="post-left" data-v-8dab3852><p class="blog-img mobile-hide" data-v-8dab3852><img src="/img/blog/blog_user.png" alt class="middle-img" data-v-8dab3852></p> <p class="mobile-hide" data-v-8dab3852><img src="/img/blog/account.svg" alt class="mobile-middle-img" data-v-8dab3852> <span class="blog-author" data-v-8dab3852>Wang Xingang</span></p> <p class="mobile-hide" data-v-8dab3852><img src="/img/blog/date.svg" alt class="mobile-middle-img" data-v-8dab3852> <span class="blog-date mobile" data-v-8dab3852>2020-11-21</span></p> <p class="mobile-hide" data-v-8dab3852><img src="/img/blog/visibility.svg" alt class="mobile-middle-img" data-v-8dab3852> <span class="blog-date" data-v-8dab3852><span data-v-8dab3852><span data-v-8dab3852>浏览</span> <span data-v-8dab3852></span> <span data-v-8dab3852>次</span></span></span></p> <p class="bottom-line bottom-line-none" data-v-8dab3852></p> <!----> <p class="other-blog-item" data-v-8dab3852></p></div> <div class="post-right" data-v-8dab3852><p class="blog-title" data-v-8dab3852>IOMMU和Arm SMMU介绍</p> <div class="user-info-mobile" data-v-8dab3852><div class="left" data-v-8dab3852><img src="/img/blog/blog_user.png" alt data-v-8dab3852></div> <div class="right" data-v-8dab3852><p class="name" data-v-8dab3852>Wang Xingang</p> <p class="date-count" data-v-8dab3852><span class="date" data-v-8dab3852>2020-11-21</span> <span class="count" data-v-8dab3852>浏览次</span></p></div></div> <p class="blog-item-tag" data-v-8dab3852><span data-v-8dab3852>标签: </span> <span data-v-8dab3852><span class="tag-item" data-v-8dab3852>IOMMU</span> <span data-v-8dab3852>, </span></span><span data-v-8dab3852><span class="tag-item" data-v-8dab3852>SMMU</span> <span data-v-8dab3852>, </span></span><span data-v-8dab3852><span class="tag-item" data-v-8dab3852>DMA</span> <!----></span></p> <p class="bottom-line bottom-line-none" data-v-8dab3852></p> <div id="blog_content" class="markdown content__default" data-v-8dab3852><h2 id="iommu-介绍"><a href="#iommu-介绍" class="header-anchor">#</a> IOMMU 介绍</h2> <p>在计算机体系结构中IOMMU（Input Output Memory Management Unit）是将设备直接内存访问（DMA）的IO总线和物理内存连接的内存管理单元，和传统的MMU一样，IOMMU将设备可见的虚拟地址（IOVA）映射到物理地址。不同的平台有不同的IOMMU，如Intel的IOMMU，PCIE图形卡使用的图形重映射表（GART），Arm平台的IOMMU是SMMU（System Memory Management），它们主要功能都是完成设备可见的IOVA到物理地址的映射。</p> <p>CPU和外设访问物理内存：</p> <div class="language- extra-class"><pre class="language-text"><code>    +---------------------+
    |      Main Memory    |
    +---------------------+
               |
              pa
               |
         -------------
         |           |
    +--------+   +--------+
    | IOMMU  |   |  MMU   |
    +--------+   +--------+
         |           |
       iova          va
         |           |
    +--------+   +--------+
    | Device |   |  CPU   |
    +--------+   +--------+
</code></pre></div><p>相对于设备DMA直接访问内存，使用IOMMU有很明显的优点：</p> <ul><li>可以在内存中分配比较大的非连续区域，IOMMU可以将连续的虚拟地址映射到零散的物理地址</li> <li>即使设备不支持足够长的内存寻址来访问整个物理内存，也可以通过IOMMU来完成整个内存的寻址。比如x86计算机可以额通过物理地址扩展（PAE）功能寻址超过4GB的内存，但是普通的32位PCI设备则无法寻址超过4GB的内存，有IOMMU则可以让设备访问整个物理内存。</li> <li>由于设备无法直接读取或写入映射的物理内存，可以保护内存免受恶意设备进行DMA攻击和尝试错误的内存传输。</li> <li>在虚拟化场景中，Guest OS可以使用非专门位虚拟化设计的硬件，比如将高性能硬件如显卡直通给虚拟机，通过DMA直接访问内存。在虚拟化环境中，所有的内存地址都由虚拟化程序（如Qemu）进行重映射，Guest OS使用DMA直接访问内存时会发生故障，只有IOMMU完成了重映射之后，Guest OS才可以驱动设备正确进行DMA访存。</li> <li>在有些体系结构中，IOMMU还以类似地址重映射的方式进行中断重映射。</li> <li>IOMMU还可以支持外围设备内存分页，使用PCI-SIG PCIe地址转换服务（ATS）PRI扩展的外围设备可以检测并通知内存管理服务。</li></ul> <p>相对于DMA直接访问物理内存，使用IOMMU的缺点主要体现在额外的性能和内存开销，地址翻译和缺页处理会增加额外的性能开销，并且IOMMU需要在内存中为IO页表分配空间，在有些情况下IOMMU和CPU共享页表可以避免这一内存开销，比如设备和CPU共享虚拟地址SVA。</p> <h2 id="arm-smmu-数据结构"><a href="#arm-smmu-数据结构" class="header-anchor">#</a> Arm SMMU 数据结构</h2> <p>SMMU（System Memory Management Unit）是Arm平台的IOMMU，
SMMU为设备提供用设备可见的IOVA地址来访问物理内存的能力，体系结构中可能存在多个设备使用IOVA经过IOMMU来访问物理内存，IOMMU需要能够区分不同的设备，从而为每个设备引入了一个Stream ID，指向对应的STE（Stream Table Entry），所有的STE在内存中以数组的形式存在，SMMU记录STE数组的首地址。在操作系统扫描设备的时候会为其分配独有的Stream ID简称sid，设备通过IOMMU进行访存的所有配置都写在对应sid的STE中。</p> <p>Stream Table：</p> <div class="language- extra-class"><pre class="language-text"><code>                  +-------+
strtab_base ----- | STE 0 |
                  | STE 1 |
StreamID[n:0] -&gt;  | STE 2 |
                  | STE 3 |
                  +-------+
</code></pre></div><p>STE表项中保存了从IOVA到PA的地址翻译过程，为了适应虚拟化场景下的访存需求，SMMU设计了类似EPT页表的两级地址翻译过程。Stage 1 完成从虚拟地址VA到中间地址IPA的翻译过程，stage 2 完成从IPA到实际物理地址的翻译过程。</p> <p>Stream Table Entry：</p> <div class="language- extra-class"><pre class="language-text"><code>Stream Table Entry (STE)
+-----------------------+ 
| Config | S1ContextPtr | -&gt; CD -&gt; Stage 1 translation tables
+-----------------------+
|  VMID  | S2TTB        | -&gt; Stage 2 translation tables
+-----------------------+
| Other attributes,     |
| configuration         |
+-----------------------+
</code></pre></div><p>对于非虚拟化场景，设备使用IOVA经过IOMMU进行DMA只需要经过Stage 1的地址转换，因为多个设备可能使用一个设备，所以每个设备的STE中还记录了CD（Context Descriptor）表的信息，由S1ContextPtr指向内存中CD表的基地址，CD表也是一个数组，使用SubstreamID来进行访存，简称ssid，也叫做pasid，pasid是与进程关联的id，用于区分不同进程的虚拟地址空间。在使用pasid找到对应的CD表项之后，也就找到了Stage 1地址翻译的IO页表，保存在TTB0和TTB1中。</p> <p>Context Descriptor：</p> <div class="language- extra-class"><pre class="language-text"><code>                  +-------+
S1ContextPtr ---- |  CD 0 |
                  |  CD 1 |
SubStreamID   -&gt;  |  CD 2 |
                  |  CD 3 |
                  +-------+

Context Desctriptor (CD)
+-----------------------+ 
| Configuration | TTB0  | 
+-----------------------+
|      ASID     | TTB1  |
+-----------------------+
</code></pre></div><p>值得一提的是，在一般情况下，进程通过设备驱动让设备进行DMA时使用的IOVA由内核态驱动分配，当存在多个进程时，将该内核态的IOVA映射到进程的虚拟地址空间即可，也就是说不同进程在DMA时其实使用的是相同的IOVA地址空间，所以这时只需要第0项CD即可，一般只需要在CD0中保存IO页表的基地址。然而，当需要统一设备的IO地址空间和进程的虚拟地址空间，如共享虚拟地址访问（SVA）时，则会用到多个CD项分别绑定不同进程的虚拟地址空间。</p> <p>设备经过SMMU进行地址翻译是一个很复杂的过程，首先会根据设备的sid（Stream ID）找到对应的STE项，STE项中的配置信息记录了是否需要Bypass Stage 1 的地址翻译，Bypass意味着直接使用PA（或IPA），如果没有Bypass会根据sid（Substream ID）找到对应CD项，CD项中记录了Stage 1地址翻译的页表，会将VA翻译成IPA，然后如果STE中还配置了Stage 2 的页表翻译，会根据Stage 2地址翻译的页表，将IPA翻译成最终的PA地址，如果没有配置Stage 2地址翻译，则之前获取到的IPA就是最终的PA地址。</p> <p>SMMU地址翻译过程：</p> <div class="language- extra-class"><pre class="language-text"><code>                         VA
                          |
                    -----------
                    |         |
+---------------------+       |
| Stage 1 translation |    Bypass
|        VA-&gt;IPA      |       |
+---------------------+       |
                    |         |
                    -----------
                          |
                         IPA
                          |
                    -----------
                    |         |
+---------------------+       |
| Stage 2 translation |    Bypass
|        IPA-&gt;VA      |       |
+---------------------+       |
                    |         |
                    -----------
                          |
                         PA
</code></pre></div><h2 id="arm-smmu-v3-初始化"><a href="#arm-smmu-v3-初始化" class="header-anchor">#</a> Arm SMMU V3 初始化</h2> <p>所有IOMMU相关的驱动都在内核 drivers/iommu 目录下面，arm平台的最新的架构SMMU-v3的驱动为arm-smmu-v3.c，SMMU本身是一个平台设备，<code>struct arm_smmu_device</code>结构体在内存中管理SMMU设备的关键信息，内核对SMMU设备本身的初始化过程主要就是在填充这个结构体。</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token comment">/* An SMMUv3 instance */</span>
<span class="token keyword">struct</span> <span class="token class-name">arm_smmu_device</span> <span class="token punctuation">{</span>
	<span class="token keyword">struct</span> <span class="token class-name">device</span>			<span class="token operator">*</span>dev<span class="token punctuation">;</span>
	<span class="token keyword">void</span> __iomem			<span class="token operator">*</span>base<span class="token punctuation">;</span>
	u32				features<span class="token punctuation">;</span>
	u32				options<span class="token punctuation">;</span>

	<span class="token keyword">struct</span> <span class="token class-name">arm_smmu_cmdq</span>		cmdq<span class="token punctuation">;</span>
	<span class="token keyword">struct</span> <span class="token class-name">arm_smmu_evtq</span>		evtq<span class="token punctuation">;</span>
	<span class="token keyword">struct</span> <span class="token class-name">arm_smmu_priq</span>		priq<span class="token punctuation">;</span>

	<span class="token keyword">int</span>				gerr_irq<span class="token punctuation">;</span>
	<span class="token keyword">int</span>				combined_irq<span class="token punctuation">;</span>
	u32				sync_nr<span class="token punctuation">;</span>

	<span class="token keyword">unsigned</span> <span class="token keyword">long</span>			ias<span class="token punctuation">;</span> <span class="token comment">/* IPA */</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">long</span>			oas<span class="token punctuation">;</span> <span class="token comment">/* PA */</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">long</span>			pgsize_bitmap<span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ARM_SMMU_MAX_ASIDS</span>		<span class="token expression"><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">)</span></span></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">int</span>			asid_bits<span class="token punctuation">;</span>
	<span class="token function">DECLARE_BITMAP</span><span class="token punctuation">(</span>asid_map<span class="token punctuation">,</span> ARM_SMMU_MAX_ASIDS<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ARM_SMMU_MAX_VMIDS</span>		<span class="token expression"><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">)</span></span></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">int</span>			vmid_bits<span class="token punctuation">;</span>
	<span class="token function">DECLARE_BITMAP</span><span class="token punctuation">(</span>vmid_map<span class="token punctuation">,</span> ARM_SMMU_MAX_VMIDS<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">unsigned</span> <span class="token keyword">int</span>			ssid_bits<span class="token punctuation">;</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">int</span>			sid_bits<span class="token punctuation">;</span>

	<span class="token keyword">struct</span> <span class="token class-name">arm_smmu_strtab_cfg</span>	strtab_cfg<span class="token punctuation">;</span>

	<span class="token comment">/* IOMMU core code handle */</span>
	<span class="token keyword">struct</span> <span class="token class-name">iommu_device</span>		iommu<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>驱动加载的入口为 arm_smmu_device_probe 函数，其主要做了如下几件事情：</p> <ol><li>从dts的SMMU节点或ACPI的SMMU配置表中读取SMMU中断等属性</li> <li>用struct resource 来从设备获取到其资源信息，并IO重映射</li> <li>probe SMMU的硬件特性</li> <li>中断和事件队列初始化</li> <li>建立STE表</li> <li>设备reset</li> <li>将SMMU注册到IOMMU</li></ol> <h3 id="_1-读取dts的smmu节点信息"><a href="#_1-读取dts的smmu节点信息" class="header-anchor">#</a> 1. 读取dts的SMMU节点信息</h3> <p>函数 arm_smmu_device_dt_probe 读取节点信息主要是从 smmu-&gt;dev-&gt;of_node中读取对应的属性，并记录到 smmu-&gt;options 中，此外还会检查 DMA 是否支持 coherent， 是的话会设置COHERENCY特性。</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">of_dma_is_coherent</span><span class="token punctuation">(</span>dev<span class="token operator">-&gt;</span>of_node<span class="token punctuation">)</span><span class="token punctuation">)</span>
      smmu<span class="token operator">-&gt;</span>features <span class="token operator">|=</span> ARM_SMMU_FEAT_COHERENCY<span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-获取设备资源信息并io重映射"><a href="#_2-获取设备资源信息并io重映射" class="header-anchor">#</a> 2. 获取设备资源信息并IO重映射</h3> <p>获取到SMMU设备的资源信息保存在 <code>struct resource</code> 结构体中，记录IO基地址，并用 smmu-&gt;base 记录完成IO重映射之后的基地址。之后就可以通过 smmu-&gt;base 加偏移读写SMMU的硬件寄存器。</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token comment">/* Base address */</span>
res <span class="token operator">=</span> <span class="token function">platform_get_resource</span><span class="token punctuation">(</span>pdev<span class="token punctuation">,</span> IORESOURCE_MEM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ioaddr <span class="token operator">=</span> res<span class="token operator">-&gt;</span>start<span class="token punctuation">;</span>
smmu<span class="token operator">-&gt;</span>base <span class="token operator">=</span> <span class="token function">devm_ioremap_resource</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_3-probe-smmu硬件特性"><a href="#_3-probe-smmu硬件特性" class="header-anchor">#</a> 3. probe SMMU硬件特性</h3> <p>函数 arm_smmu_device_hw_probe 通过读取 SMMU 的寄存器获取SMMU的硬件特性，</p> <p>IDR0寄存器：</p> <div class="language- extra-class"><pre class="language-text"><code>reg = readl_relaxed(smmu-&gt;base + ARM_SMMU_IDR0);
</code></pre></div><ul><li>是否支持：两级STE表、两级CD表</li> <li>是否支持：PRI、ATS、SEV、MSI、HYP、STALL、Stage 1、Stage 2</li> <li>获取：ias长度、asid_bits、vmid_bits</li></ul> <p>IDR1寄存器：</p> <div class="language-c extra-class"><pre class="language-c"><code>reg <span class="token operator">=</span> <span class="token function">readl_relaxed</span><span class="token punctuation">(</span>smmu<span class="token operator">-&gt;</span>base <span class="token operator">+</span> ARM_SMMU_IDR1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>获取：evtq和priq的队列长度、ssid_bits、sid_bits、</li></ul> <p>IDR5寄存器：</p> <div class="language-c extra-class"><pre class="language-c"><code>reg <span class="token operator">=</span> <span class="token function">readl_relaxed</span><span class="token punctuation">(</span>smmu<span class="token operator">-&gt;</span>base <span class="token operator">+</span> ARM_SMMU_IDR5<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>获取：evtq最多能stall的的数量</li> <li>是否支持：VAX、oas长度、pgsize_bitmap</li></ul> <h3 id="_4-中断和事件队列初始化"><a href="#_4-中断和事件队列初始化" class="header-anchor">#</a> 4. 中断和事件队列初始化</h3> <p>函数 arm_smmu_init_structures 会完成内存中的数据结构的初始化，包括三条队列evtq、priq、cmdq，cmdq用于SMMU驱动向硬件发送命令，比如刷新TLB、写CD内容等，event队列用于SMMU上挂载的platform设备向驱动发送异常消息，priq队列功能类似只不过用于挂载的PCI设备。event队列和pri队列分别有各自的中断号完成异常事件的通知，此外还有一个gerror的中断号用于上报不可恢复（unrecoverable）的严重错误，其直接中断处理不需要队列。</p> <div class="language-c extra-class"><pre class="language-c"><code>irq <span class="token operator">=</span> <span class="token function">platform_get_irq_byname</span><span class="token punctuation">(</span>pdev<span class="token punctuation">,</span> <span class="token string">&quot;combined&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>irq <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
      smmu<span class="token operator">-&gt;</span>combined_irq <span class="token operator">=</span> irq<span class="token punctuation">;</span>
<span class="token keyword">else</span> <span class="token punctuation">{</span>
      irq <span class="token operator">=</span> <span class="token function">platform_get_irq_byname</span><span class="token punctuation">(</span>pdev<span class="token punctuation">,</span> <span class="token string">&quot;eventq&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>irq <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            smmu<span class="token operator">-&gt;</span>evtq<span class="token punctuation">.</span>q<span class="token punctuation">.</span>irq <span class="token operator">=</span> irq<span class="token punctuation">;</span>

      irq <span class="token operator">=</span> <span class="token function">platform_get_irq_byname</span><span class="token punctuation">(</span>pdev<span class="token punctuation">,</span> <span class="token string">&quot;priq&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>irq <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            smmu<span class="token operator">-&gt;</span>priq<span class="token punctuation">.</span>q<span class="token punctuation">.</span>irq <span class="token operator">=</span> irq<span class="token punctuation">;</span>

      irq <span class="token operator">=</span> <span class="token function">platform_get_irq_byname</span><span class="token punctuation">(</span>pdev<span class="token punctuation">,</span> <span class="token string">&quot;gerror&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>irq <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            smmu<span class="token operator">-&gt;</span>gerr_irq <span class="token operator">=</span> irq<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/* Initialise in-memory data structures */</span>
ret <span class="token operator">=</span> <span class="token function">arm_smmu_init_structures</span><span class="token punctuation">(</span>smmu<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在驱动进行SMMU设备reset的时候，arm_smmu_setup_unique_irqs 会注册相应的事件处理，eventq和priq会注册内核线程完成事件处理，而对于不可恢复错误gerror则直接注册函数完成中断处理。</p> <h3 id="_5-建立ste表"><a href="#_5-建立ste表" class="header-anchor">#</a> 5. 建立STE表</h3> <p>根据SMMU的配置不同，可以建立两级或者线性STE表，相对于线性STE表，两级STE表不需要一开始创建所有的STE项，只需要先分配第一级的目录项即可。对于STE线性表，根据sid_bits和STE项的大小，在内存中用dma分配一块连续的内存，在配置中记录其基地址，然后将所有的STE项配置成默认情况下的bypass模式。</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">arm_smmu_init_strtab_linear</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">arm_smmu_device</span> <span class="token operator">*</span>smmu<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">void</span> <span class="token operator">*</span>strtab<span class="token punctuation">;</span>
	u64 reg<span class="token punctuation">;</span>
	u32 size<span class="token punctuation">;</span>
	<span class="token keyword">struct</span> <span class="token class-name">arm_smmu_strtab_cfg</span> <span class="token operator">*</span>cfg <span class="token operator">=</span> <span class="token operator">&amp;</span>smmu<span class="token operator">-&gt;</span>strtab_cfg<span class="token punctuation">;</span>

	size <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> smmu<span class="token operator">-&gt;</span>sid_bits<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>STRTAB_STE_DWORDS <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	strtab <span class="token operator">=</span> <span class="token function">dmam_alloc_coherent</span><span class="token punctuation">(</span>smmu<span class="token operator">-&gt;</span>dev<span class="token punctuation">,</span> size<span class="token punctuation">,</span> <span class="token operator">&amp;</span>cfg<span class="token operator">-&gt;</span>strtab_dma<span class="token punctuation">,</span>
				     GFP_KERNEL <span class="token operator">|</span> __GFP_ZERO<span class="token punctuation">)</span><span class="token punctuation">;</span>

	cfg<span class="token operator">-&gt;</span>strtab <span class="token operator">=</span> strtab<span class="token punctuation">;</span>
	cfg<span class="token operator">-&gt;</span>num_l1_ents <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> smmu<span class="token operator">-&gt;</span>sid_bits<span class="token punctuation">;</span>

	<span class="token comment">/* Configure strtab_base_cfg for a linear table covering all SIDs */</span>
	reg  <span class="token operator">=</span> <span class="token function">FIELD_PREP</span><span class="token punctuation">(</span>STRTAB_BASE_CFG_FMT<span class="token punctuation">,</span> STRTAB_BASE_CFG_FMT_LINEAR<span class="token punctuation">)</span><span class="token punctuation">;</span>
	reg <span class="token operator">|=</span> <span class="token function">FIELD_PREP</span><span class="token punctuation">(</span>STRTAB_BASE_CFG_LOG2SIZE<span class="token punctuation">,</span> smmu<span class="token operator">-&gt;</span>sid_bits<span class="token punctuation">)</span><span class="token punctuation">;</span>
	cfg<span class="token operator">-&gt;</span>strtab_base_cfg <span class="token operator">=</span> reg<span class="token punctuation">;</span>

	<span class="token function">arm_smmu_init_bypass_stes</span><span class="token punctuation">(</span>strtab<span class="token punctuation">,</span> cfg<span class="token operator">-&gt;</span>num_l1_ents<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_6-设备-reset"><a href="#_6-设备-reset" class="header-anchor">#</a> 6. 设备 reset</h3> <p>函数 arm_smmu_device_reset 会进行设备的复位操作，通过前面获取到的设备寄存器，对控制寄存器CR1和CR2写入队列内存属性等信息，对STRTAB_BASE寄存器写入STE表的基地址和配置信息，将三条队列在内存中的基地址、队首和队尾信息分别写入对应的寄存器中，之后 reset 会调用arm_smmu_setup_irqs注册中断事件的处理操作。</p> <h3 id="_7-将smmu注册到iommu"><a href="#_7-将smmu注册到iommu" class="header-anchor">#</a> 7. 将SMMU注册到IOMMU</h3> <p>不同平台的IOMMU设备在Linux内核中抽象出了统一的IOMMU接口，SMMU的初始化会在sys目录下面注册一个smmu-&gt;iommu设备节点，并且将arm_smmu_ops注册给该设备以及系统PCI总线和平台设备总线。这样当使用IOMMU公共接口时，会调用smmu提供的功能，具体可以查看arm_smmu_ops中提供的各种IOMMU接口实现。</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token function">iommu_device_sysfs_add</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>smmu<span class="token operator">-&gt;</span>iommu<span class="token punctuation">,</span> dev<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span>
			     <span class="token string">&quot;smmu3.%pa&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>ioaddr<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">iommu_device_set_ops</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>smmu<span class="token operator">-&gt;</span>iommu<span class="token punctuation">,</span> <span class="token operator">&amp;</span>arm_smmu_ops<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">iommu_device_set_fwnode</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>smmu<span class="token operator">-&gt;</span>iommu<span class="token punctuation">,</span> dev<span class="token operator">-&gt;</span>fwnode<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">iommu_device_register</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>smmu<span class="token operator">-&gt;</span>iommu<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">bus_set_iommu</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pci_bus_type<span class="token punctuation">,</span> <span class="token operator">&amp;</span>arm_smmu_ops<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">bus_set_iommu</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>platform_bus_type<span class="token punctuation">,</span> <span class="token operator">&amp;</span>arm_smmu_ops<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="iommu与dma"><a href="#iommu与dma" class="header-anchor">#</a> IOMMU与DMA</h2> <p>IOMMU的主要功能之一就是避免设备在进行DMA访问内存的时候直接使用物理地址不安全，所以就产生了IOVA地址，在dma_alloc分配内存的时候，首先在IO地址空间分配一个IOVA地址，然后在IOMMU管理的页表中建立IOVA和dma_alloc分配的物理地址的映射关系，外设在进行dma的时候，只需要使用IOVA地址即可。</p> <p>调用 dma alloc 系列函数分配内存最终会调到 iommu_dma_alloc 函数，其会分配iova和实际的物理内存，并用iommu_map建立iova到物理内存的映射关系，也就是找到设备对应的STE，并找到CD项（一般是第0项），然后找到内存中对应的页表，将iova到物理地址的映射写入页表中，arm SMMU 相关的页表操作在 io-pgtable.c中完成。</p> <div class="language-c extra-class"><pre class="language-c"><code>iommu_dma_alloc
      pages <span class="token operator">=</span> <span class="token function">__iommu_dma_alloc_pages</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> alloc_sizes <span class="token operator">&gt;&gt;</span> PAGE_SHIFT<span class="token punctuation">,</span> gfp<span class="token punctuation">)</span><span class="token punctuation">;</span>
      iova <span class="token operator">=</span> <span class="token function">iommu_dma_alloc_iova</span><span class="token punctuation">(</span>domain<span class="token punctuation">,</span> size<span class="token punctuation">,</span> dev<span class="token operator">-&gt;</span>coherent_dma_mask<span class="token punctuation">,</span> dev<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token function">iommu_map_sg</span><span class="token punctuation">(</span>domain<span class="token punctuation">,</span> iova<span class="token punctuation">,</span> sgt<span class="token punctuation">.</span>sgl<span class="token punctuation">,</span> sgt<span class="token punctuation">.</span>orig_nents<span class="token punctuation">,</span> prot
</code></pre></div><p>可以有多种方式bypass掉IOMMU，首先Linux提供了iommu.passthrough的方式，可以配置dma默认不走iommu，通过软件的地址映射技术swiotlb来访存；其次，SMMU v3驱动中提供了参数可以bypass掉某个SMMU；第三十可以在ACPI或者DTS中不配置对应的SMMU节点，这样系统加载的时候就不会probe对应的SMMU了。</p> <h2 id="小结"><a href="#小结" class="header-anchor">#</a> 小结</h2> <p>IOMMU的主要功能就是为设备访问物理内存提供IOVA到PA的映射，使得设备不会直接使用物理地址来访存比较安全。Arm SMMUv3 作为IOMMU的一种具体实现，为其提供相应的接口。与IOMMU相关的包括设备进行DMA操作，VFIO直通将设备硬件能力安全的暴露给用户态等，本质上都是为了建立设备能够识别的IOVA到实际物理地址的映射关系。</p> <h2 id="reference"><a href="#reference" class="header-anchor">#</a> Reference：</h2> <ul><li>https://en.wikipedia.org/wiki/Input%E2%80%93output_memory_management_unit</li> <li>https://developer.arm.com/documentation/ihi0070/latest</li> <li>https://kernel.taobao.org/2020/06/ARM-SMMU-and-IOMMU/</li></ul></div></div> <div class="bottom-line" data-v-8dab3852></div> <div class="disclaimer" data-v-8dab3852>【版权声明】Copyright © 2021 openEuler Community。本文由openEuler社区首发，欢迎遵照 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/legalcode" data-v-8dab3852>CC-BY-SA 4.0</a> 协议规定转载。转载时敬请在正文注明并保留原文链接和作者信息。</div> <div class="disclaimer" data-v-8dab3852>
        【免责声明】本文仅代表作者本人观点，与本网站无关。本网站对文中陈述、观点判断保持中立，不对所包含内容的准确性、可靠性或完整性提供任何明示或暗示的保证。本文仅供读者参考，由此产生的所有法律责任均由读者本人承担。
    </div></div> <div class="footer-wrapper" data-v-0b78f953 data-v-34596062><div class="qr-code" data-v-0b78f953><img src="/img/common/newyear-qr.png" alt data-v-0b78f953> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MTBGRjQxMDc4MTFBMTFFNDg4RUU4NENEQTQxODZDMjciIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MTBGRjQxMDg4MTFBMTFFNDg4RUU4NENEQTQxODZDMjciPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDoxMEZGNDEwNTgxMUExMUU0ODhFRTg0Q0RBNDE4NkMyNyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDoxMEZGNDEwNjgxMUExMUU0ODhFRTg0Q0RBNDE4NkMyNyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PvJh/V0AAAJMSURBVHja5Je7L0RBFMatCEEiQYcCBYKo6IgQu0SnIhuFXUsUdBL/gEqt8dhVSNajUbJsSFBqiHeBSsUqiHeyvknOTcaYuffsI9nCSX7Z2bsz8317Z848XPF4PCuTkZ2V4cixCl6vl9umCDSBOlBMz57AJTgGz5xOwuHwbwOMaABDoBfUG+qcgU2wBM7TNQSlIAhOwaSNuGVykowsgpJUDXSDa+BPYniHqa0nWQMDYIvzLxzeXgT0J2qgHaykcbKvgjaugUJyne7YAQUcA/MgT/P8C2wzhESdb81z0eeck4EqsSRoGt+DTpqUQRvxINXpoDZqDIJKOwMTNvl9SOUACBnEA1Q+pDa6GDcZEOPTZ2jkpryWU0w2EZLELTNuQ19CI//PUoxoUV+PJq9d9Gl9L5fKshmfTT/VoBkcqAZqGRPMrwj2KL87ictaB+oQcBccP6VUrvRMlKNM8V9aGd+OZQMxZhtrgn1Kz0S5i3ZBTsR0Bi6Z4vJsjyirpt+Qompc6QwcgVubRouKeIh2Oo8iOuywWN2Q1h8Dr2DDZnkdsZntPkU0QBNVF0LjzTQJZw2NGkGrNAw+Q3ZYJtrocKKLWe2ZkEIMQVizH5SBPbDrcMAQJipo39Ad95bBndNuKF71h+EA62FMMI9B/B2McbbjV6ZQouGmvlknon06kqUr+qXdlH0mXKO9/TEF4Qf65+vJnopF+tU45LUpFqhtNNV7QYzyWtwHZuh+YIpTqiPqjtKNiXc1Y8QFmALThquZ+P0EvCTymlz//nb8I8AA0Ah5h1oiyB4AAAAASUVORK5CYII=" alt class="close" data-v-0b78f953></div> <div class="atom" data-v-0b78f953><p data-v-0b78f953>openEuler 是由开放原子开源基金会（OpenAtom Foundation）孵化及运营的开源项目</p> <img src="/atom-pc.png" alt class="atom-pc" data-v-0b78f953></div> <div class="footer-content" data-v-0b78f953><div class="footer-left" data-v-0b78f953><img src="/footer-logo2.svg" class="footer-logo" data-v-0b78f953> <div class="footer-mail" data-v-0b78f953>contact@openeuler.io</div></div> <div class="footer-center" data-v-0b78f953><ul class="right-list" data-v-0b78f953><li data-v-0b78f953><a data-v-0b78f953>品牌</a></li><li data-v-0b78f953><a data-v-0b78f953>隐私政策</a></li><li data-v-0b78f953><a data-v-0b78f953>法律声明</a></li><li data-v-0b78f953><a data-v-0b78f953>服务状态</a></li></ul> <p class="footer-copyright" data-v-0b78f953>
        版权所有 © 2022 openEuler 保留一切权利
      </p></div> <div class="footer-right" data-v-0b78f953><img src="/qrcode.png" class="footer-qrcode" data-v-0b78f953> <div class="qrcode-desc" data-v-0b78f953>扫码关注公众号</div></div></div></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.cdfb7ee7.js" defer></script><script src="/assets/js/14.8a38dea1.js" defer></script><script src="/assets/js/310.c41f294a.js" defer></script>
  </body>
</html>
