(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{1663:function(t,a,s){"use strict";s.r(a);var n=s(42),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h2",{attrs:{id:"概要"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#概要"}},[t._v("#")]),t._v(" 概要")]),t._v(" "),n("p",[t._v("本文分为两部分：")]),t._v(" "),n("ul",[n("li",[t._v("利用Source Services（下称源服务）直接获取git源码并编译成包")]),t._v(" "),n("li",[t._v("利用webhook 使源服务在git仓库push时触发，从而实现OBS始终跟进git仓库最新版本源码的效果")])]),t._v(" "),n("blockquote",[n("p",[t._v("此文章的全部步骤使用"),n("a",{attrs:{href:"http://openeuler-build.huawei.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("openEuler OBS"),n("OutboundLink")],1),t._v("完成，使用其他服务器时可能出现工具不全的情况。")])]),t._v(" "),n("h2",{attrs:{id:"利用源服务直接获取git源码并编译成包"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#利用源服务直接获取git源码并编译成包"}},[t._v("#")]),t._v(" 利用源服务直接获取git源码并编译成包")]),t._v(" "),n("h3",{attrs:{id:"source-services-相关"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#source-services-相关"}},[t._v("#")]),t._v(" Source Services 相关")]),t._v(" "),n("blockquote",[n("p",[t._v("Source Services 是用于以可靠方式验证，生成或修改源的工具。它们被设计为最小的工具，并且可以按照经典UNIX设计的强大思想进行组合。")])]),t._v(" "),n("p",[t._v("源服务就像是系统中的函数，我们可以通过运行脚本调用它；而脚本就是Package中的_service文件。")]),t._v(" "),n("h3",{attrs:{id:"创建使用源服务的package"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建使用源服务的package"}},[t._v("#")]),t._v(" 创建使用源服务的Package")]),t._v(" "),n("ol",[n("li",[t._v("通过命令行工具或者网页新建一个空的Package")])]),t._v(" "),n("img",{attrs:{src:s(633)}}),t._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[n("p",[t._v("进入Package目录并创建_service:")]),t._v(" "),n("ul",[n("li",[t._v("网页端点击"),n("em",[t._v("Add file")]),t._v(" ，点击"),n("em",[t._v("Choose a file")]),t._v("，并选择本地建好的_service文件。")]),t._v(" "),n("li",[t._v("命令行则在Package目录中新建_service文件并上传之服务器。")])])]),t._v(" "),n("li",[n("p",[t._v("准备编辑_service文件")])])]),t._v(" "),n("h3",{attrs:{id:"编辑-service文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#编辑-service文件"}},[t._v("#")]),t._v(" 编辑_service文件")]),t._v(" "),n("p",[t._v("最基础的_service文件将会如下所示：")]),t._v(" "),n("div",{staticClass:"language-powershell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-powershell"}},[n("code",[t._v("\t<services>\n\t  <service name="),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tar_scm"')]),t._v(">\n\t    <"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("param")]),t._v(" name="),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"scm"')]),t._v(">git<"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("param")]),t._v(">\n\t    <"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("param")]),t._v(" name="),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"url"')]),t._v(">git:"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("github"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("cs2c"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("fu"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("hi"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("git<"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("param")]),t._v(">\n\t  <"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("service>\n\t  <service name="),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"recompress"')]),t._v(" mode="),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"buildtime"')]),t._v(">\n\t    <"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("param")]),t._v(" name="),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"compression"')]),t._v(">xz<"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("param")]),t._v(">\n\t    <"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("param")]),t._v(" name="),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"file"')]),t._v(">"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tar<"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("param")]),t._v(">\n\t  <"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("service>\n\t  <service name="),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"set_version"')]),t._v(" mode="),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"buildtime"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(">\n\t<"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("services>\n")])])]),n("p",[t._v("最外层为"),n("code",[t._v("<services>")]),t._v("标记，在"),n("code",[t._v("<services>")]),t._v("内则为一个个"),n("code",[t._v("<service>")]),t._v("函数，而"),n("code",[t._v("<param>")]),t._v("则为"),n("code",[t._v("<service>")]),t._v("函数的参数。")]),t._v(" "),n("p",[t._v("为了实现“"),n("strong",[t._v("利用源服务直接获取git源码并编译成包")]),t._v("”这个目标，")]),t._v(" "),n("p",[t._v("我们的_service应该类似于这样（以下格式请根据具体情况选择合适的顺序）：")]),t._v(" "),n("div",{staticClass:"language-xml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-xml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("services")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("service")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("tar_scm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("param")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("scm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("git"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("param")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("param")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("filename"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("helloworld"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("param")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("param")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("git://github.com/cs2c-fu/hi.git"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("param")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("param")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("versionprefix"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("VERSION.git"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("param")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("service")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("service")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("extract_file"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("param")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("archive"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("*.*"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("param")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("param")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("files"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("*/*.spec */*.patch"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("param")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("service")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("service")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("recompress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("mode")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("buildtime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("param")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("compression"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("xz"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("param")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("param")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("file"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("*.tar"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("param")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("service")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("service")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("set_version"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("mode")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("buildtime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("services")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),n("p",[t._v("下面将对所需的服务逐一进行介绍：")]),t._v(" "),n("p",[n("strong",[t._v("第一个服务："),n("a",{attrs:{href:"https://github.com/openSUSE/obs-service-tar_scm",target:"_blank",rel:"noopener noreferrer"}},[t._v("tar_scm"),n("OutboundLink")],1)])]),t._v(" "),n("p",[n("strong",[t._v("tar_scm")]),t._v(" 会将链接 url 中的仓库下载下来并打包为 tar 文件，文件包命名格式为：")]),t._v(" "),n("blockquote",[n("p",[t._v("[Name]-[Version].[commit_timestamp].tar")])]),t._v(" "),n("p",[t._v("其中，[commit_timestamp]为 commit 十六进制时间戳。")]),t._v(" "),n("p",[t._v("可选参数：")]),t._v(" "),n("ul",[n("li",[n("strong",[t._v("filename")]),t._v(" 定义打包后文件的 Name，默认为git仓库名。")]),t._v(" "),n("li",[n("strong",[t._v("versionprefix")]),t._v(" 定以打包后文件的 Version 格式，默认为当前十进制时间戳。")])]),t._v(" "),n("p",[t._v("在OBS官方服务器中， "),n("strong",[t._v("tar_scm")]),t._v(" 服务由于在空间利用率上表现不佳， 已被 "),n("strong",[t._v("obs_scm")]),t._v("、"),n("strong",[t._v("tar")]),t._v(" 服务取代，但openEuler的外网OBS暂时还不支持"),n("strong",[t._v("obs_scm")]),t._v("，所以这里选择 "),n("strong",[t._v("tar_scm")]),t._v(" 。")]),t._v(" "),n("blockquote",[n("p",[t._v("详见："),n("a",{attrs:{href:"https://openbuildservice.org/2016/04/08/new_git_in_27/",target:"_blank",rel:"noopener noreferrer"}},[t._v("链接"),n("OutboundLink")],1)])]),t._v(" "),n("p",[n("strong",[t._v("第二个服务："),n("a",{attrs:{href:"https://github.com/openSUSE/obs-service-extract_file",target:"_blank",rel:"noopener noreferrer"}},[t._v("extract_file"),n("OutboundLink")],1)])]),t._v(" "),n("p",[n("strong",[t._v("extract_file")]),t._v(" 可以从tar包中提取文件， 具体需要提取什么文件取决于git仓库中的文件格式。")]),t._v(" "),n("p",[t._v("一般来说我们可以将打包需要的内容分为四大类：")]),t._v(" "),n("ul",[n("li",[n("strong",[t._v("源码")]),t._v(" ： 参与编译过程的文件")]),t._v(" "),n("li",[n("strong",[t._v("spec文件")]),t._v(" ： 指导如何打包的规范文件")]),t._v(" "),n("li",[n("strong",[t._v("patch文件")]),t._v(" ： 修改源码的差异文件")]),t._v(" "),n("li",[n("strong",[t._v("源文件")]),t._v(" ： 不参与编译但需要打包的文件")])]),t._v(" "),n("p",[t._v("对于"),n("strong",[t._v("git仓库")]),t._v("来说，一般会将所有文件放到仓库的根目录。")]),t._v(" "),n("img",{attrs:{src:s(634)}}),t._v(" "),n("p",[t._v("此时我们需要将"),n("strong",[t._v("spec文件、patch文件、源文件")]),t._v("提取出来， "),n("strong",[t._v("源码")]),t._v("则留在tar包中等待之后的服务将其压缩打包。")]),t._v(" "),n("p",[t._v("对于"),n("strong",[t._v("OBS仓库")]),t._v("来说，为了方便OBS系统使用，人们已经对源码进行压缩打包。")]),t._v(" "),n("img",{attrs:{src:s(613)}}),t._v(" "),n("p",[t._v("此时我们需要将"),n("strong",[t._v("所有文件")]),t._v("提取出来并省略之后的压缩打包环节。")]),t._v(" "),n("p",[t._v("参数：")]),t._v(" "),n("ul",[n("li",[n("strong",[t._v("archive")]),t._v(" 定义提取来源文件格式")]),t._v(" "),n("li",[n("strong",[t._v("files")]),t._v(" 定义提取文件类型 "),n("em",[t._v("注意：存在一个顶层目录，其名称未知，因此文件名应以 “*/” 开头")])])]),t._v(" "),n("p",[n("strong",[t._v("第三个服务："),n("a",{attrs:{href:"https://github.com/openSUSE/obs-service-recompress",target:"_blank",rel:"noopener noreferrer"}},[t._v("recompress"),n("OutboundLink")],1)])]),t._v(" "),n("p",[n("strong",[t._v("recompress")]),t._v(" 会对指定文件进行压缩")]),t._v(" "),n("p",[t._v("参数：")]),t._v(" "),n("ul",[n("li",[n("strong",[t._v("compression")]),t._v(" 压缩格式，可选：none、gz、bz2、xz")]),t._v(" "),n("li",[n("strong",[t._v("file")]),t._v(" 压缩内容")])]),t._v(" "),n("p",[n("strong",[t._v("第四个服务："),n("a",{attrs:{href:"https://github.com/openSUSE/obs-service-set_version",target:"_blank",rel:"noopener noreferrer"}},[t._v("set_version"),n("OutboundLink")],1)])]),t._v(" "),n("p",[t._v("会将spec文件中的Version替换为obs_scm时的")]),t._v(" "),n("p",[n("code",[t._v("[Version].[commit_timestamp]")])]),t._v(" "),n("p",[t._v("spec文件中可以以")]),t._v(" "),n("p",[n("code",[t._v("helloworld-%{version}.tar.xz")])]),t._v(" "),n("p",[t._v("格式定位源码包。")]),t._v(" "),n("h3",{attrs:{id:"等待编译完成"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#等待编译完成"}},[t._v("#")]),t._v(" 等待编译完成")]),t._v(" "),n("p",[t._v("由于使用源服务获取源码，所以编译时需要额外过程与时间。")]),t._v(" "),n("img",{attrs:{src:s(613)}}),t._v(" "),n("p",[t._v("当状态显示为 "),n("strong",[t._v("blocked")]),t._v(" 时， 表明源服务正在运行。当源服务运行完毕时会正常开始打包过程。")]),t._v(" "),n("p",[t._v("我的参考案例："),n("a",{attrs:{href:"http://openeuler-build.huawei.com/package/show/home:changjie_fu/hi",target:"_blank",rel:"noopener noreferrer"}},[t._v("链接"),n("OutboundLink")],1)]),t._v(" "),n("h3",{attrs:{id:"source-services-在实际场景中的应用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#source-services-在实际场景中的应用"}},[t._v("#")]),t._v(" Source Services 在实际场景中的应用")]),t._v(" "),n("p",[t._v("在"),n("a",{attrs:{href:"http://openeuler-build.huawei.com/project/show/oVirt-SIG",target:"_blank",rel:"noopener noreferrer"}},[t._v("oVirt-SIG"),n("OutboundLink")],1),t._v("组中，我们应用了源服务实现代码由git到OBS的同步。")]),t._v(" "),n("p",[t._v("首先，我们在git仓库中以：**spec文件、patch文件、 "),n("strong",[t._v("源码tar包")]),t._v(" 的格式上传并管理源码。")]),t._v(" "),n("img",{attrs:{src:s(635)}}),t._v(" "),n("p",[t._v("在OBS系统中建立对应包并以一下格式定义_service文件：")]),t._v(" "),n("div",{staticClass:"language-xml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-xml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("services")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("service")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("tar_scm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("param")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("scm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("git"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("param")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("param")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("filename"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("ioprocess"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("param")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("param")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("https://gitee.com/openkylin/ioprocess.git"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("param")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("service")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("service")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("extract_file"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("param")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("archive"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("*.*"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("param")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("param")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("files"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("*/*"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("param")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("service")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("services")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),n("p",[t._v("由于我们已经很好的在git仓库中设置了存储格式， 此时我们只需将所有文件下载并提取即可。")]),t._v(" "),n("p",[t._v("在这之后，OBS系统会帮助我们完成编译与打包的环节。")]),t._v(" "),n("h2",{attrs:{id:"利用-webhook-使源服务在git仓库push时触发"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#利用-webhook-使源服务在git仓库push时触发"}},[t._v("#")]),t._v(" 利用 webhook 使源服务在git仓库push时触发")]),t._v(" "),n("p",[t._v("在写此文时，OBS系统还不支持gitee格式的webhook，所以以下内容为使用github仓库实现。")]),t._v(" "),n("blockquote",[n("p",[t._v("obs可以创建令牌（token），当令牌被触发时，OBS会运行源服务。")]),t._v(" "),n("p",[t._v("将网址与令牌添加到git仓库的webhook列表中，就可以在git仓库中实现触发源服务，进而更新OBS中的包版本。")]),t._v(" "),n("p",[n("strong",[t._v("具体步骤：")])]),t._v(" "),n("p",[t._v("创建专属包的OBS Token（OBS令牌）：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("osc token --create <PROJECT> <PACKAGE>\n")])])]),n("p",[t._v("命令将生成仅对Project/Package生效的token。")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("使用命令 "),n("code",[t._v("osc token")]),t._v(" 可以查看当前生效的令牌列表。")])]),t._v(" "),n("li",[n("p",[t._v("使用命令"),n("code",[t._v("osc token --delete <TOKEN>")]),t._v(" 可以删除令牌")])])]),t._v(" "),n("p",[t._v("打开git仓库网址（以github为例）：")]),t._v(" "),n("img",{attrs:{src:s(636)}}),t._v(" "),n("p",[t._v("打开仓库 -> Setting -> Webhooks")])]),t._v(" "),n("img",{attrs:{src:s(637)}}),t._v("\n>\n> 点击左上方的 Add webhook 。\n>\n> \n  "),n("img",{attrs:{src:s(638)}}),t._v("\n>\n> 在 Payload URL中以：\n>\n> ` http://openeuler-build.huawei.com/trigger/webhook?id=<令牌ID>`\n>\n> 为格式填入。\n> \n> 在 Secret 中填入令牌秘匙，按需求选择trigger类型， 保证Webhook为Active状态。\n>\n> 之后点击 Add webhook 即成功实现。\n>\n> 可尝试触发trigger以验证成果。\n")])}),[],!1,null,null,null);a.default=e.exports},613:function(t,a,s){t.exports=s.p+"assets/img/2020-03-26-OBS-with-Git-OBS仓库.d34423ed.png"},633:function(t,a,s){t.exports=s.p+"assets/img/2020-03-26-OBS-with-Git-空Package.e29c3c7b.png"},634:function(t,a,s){t.exports=s.p+"assets/img/2020-03-26-OBS-with-Git-git仓库.1b99f0e6.png"},635:function(t,a,s){t.exports=s.p+"assets/img/2020-03-26-OBS-with-Git-gitee仓库.dce5623b.png"},636:function(t,a,s){t.exports=s.p+"assets/img/2020-03-26-OBS-with-Git-git仓库页.6b1fbecd.png"},637:function(t,a,s){t.exports=s.p+"assets/img/2020-03-26-OBS-with-Git-Webhook页.fa6ff9f3.png"},638:function(t,a,s){t.exports=s.p+"assets/img/2020-03-26-OBS-with-Git-新建Webhook.24fa6238.png"}}]);