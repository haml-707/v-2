(window.webpackJsonp=window.webpackJsonp||[]).push([[53],{1006:function(t,s,a){t.exports=a.p+"assets/img/2020-09-14-isulad-architecture-01.cb57046e.png"},1007:function(t,s,a){t.exports=a.p+"assets/img/2020-09-14-isulad-architecture-09.85c4f48a.png"},1008:function(t,s,a){t.exports=a.p+"assets/img/2020-09-14-isulad-architecture-06.50c1c0c8.png"},1009:function(t,s,a){t.exports=a.p+"assets/img/2020-09-14-isulad-architecture-05.8f6056ef.png"},1010:function(t,s,a){t.exports=a.p+"assets/img/2020-09-14-isulad-architecture-08.4fd5eef7.png"},1011:function(t,s,a){t.exports=a.p+"assets/img/2020-09-14-isulad-architecture-07.40444c98.png"},1012:function(t,s,a){t.exports=a.p+"assets/img/2020-09-14-isulad-architecture-03.25c2992a.jpg"},1013:function(t,s,a){t.exports=a.p+"assets/img/2020-09-14-isulad-architecture-04.79239aff.jpg"},1014:function(t,s,a){t.exports=a.p+"assets/img/2020-09-14-isulad-architecture-02.1efe669e.jpg"},1677:function(t,s,a){"use strict";a.r(s);var n=a(42),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("p",[n("em",[t._v("作者简介：李峰， 具有多年容器、操作系统软件开发经验，对容器引擎、runtime 等领域有比较深入的研究与理解。深度参与 lxc、containers 等开源容器社区。现在担任 openeuler 轻量级容器引擎 iSulad 社区 maintainer。")])]),t._v(" "),n("p",[t._v("iSulad 是一种由 C/C++编程语言编写的容器引擎，当前已经在 openeuler 社区开源(https://gitee.com/openeuler/iSulad)。 当前主流的容器引擎 docker、containerd、cri-o 等均是由 GO 语言编写。随着边缘计算、物联网等嵌入式设备场景的不断兴起，在资源受限环境下，业务容器化的需求越来越强烈。由高级语言编写的容器引擎在底噪占用上的劣势越来越凸显。另外由于容器引擎对外接口的标准化，因此用 C/C++重写一个容器引擎成为了可能。iSulad 整体架构如下图所示。")]),t._v(" "),n("img",{staticStyle:{zoom:"100%"},attrs:{src:a(1006),alt:"iSulad"}}),t._v(" "),n("p",[t._v("iSulad 对外提供命令行以及基于 gRPC 的 CRI 两种对外接口，其中核心功能根据业务分为镜像管理和容器管理。")]),t._v(" "),n("p",[t._v("通过下图可以理解 iSulad 在生态中的定位。")]),t._v(" "),n("img",{staticStyle:{zoom:"100%"},attrs:{src:a(1007),alt:"iSulad"}}),t._v(" "),n("p",[t._v("本文介绍 iSulad 的功能特性以及对整体架构进行介绍。")]),t._v(" "),n("h2",{attrs:{id:"isulad-功能特性介绍"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#isulad-功能特性介绍"}},[t._v("#")]),t._v(" iSulad 功能特性介绍")]),t._v(" "),n("h3",{attrs:{id:"提供客户端命令行进行容器、镜像操作"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#提供客户端命令行进行容器、镜像操作"}},[t._v("#")]),t._v(" 提供客户端命令行进行容器、镜像操作")]),t._v(" "),n("p",[t._v("iSulad 是典型的 CS 架构模式。iSulad 作为 daemon 服务端，同时也提供了单独的客户端命令 isula，供用户使用。")]),t._v(" "),n("p",[t._v("iSula 提供的命令参数覆盖了常用的大部分的应用场景。包含容器的操作接口，如运行、停止、删除、pause 等操作，也包含了镜像相关的操作，如下载、导入、删除等。")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("$ sudo isula --help\nUSAGE:\n\tisula <command> [args...]\n\nCOMMANDS:\n\tattach \tAttach to a running container\n\tcp     \tCopy files/folders between a container and the local filesystem\n\tcreate \tCreate a new container\n\tevents \tGet real time events from the server\n\texec   \tRun a command in a running container\n\texport \texport container\n\timages \tList images\n\timport \tImport the contents from a tarball to create a filesystem image\n\tinfo   \tDisplay system-wide information\n\tinspect\tReturn low-level information on a container or image\n\tkill   \tKill one or more  running containers\n\tload   \tload an image from a tar archive\n\tlogin  \tLog in to a Docker registry\n\tlogout \tLog out from a Docker registry\n\tlogs   \tFetch the logs of a container\n\tpause  \tPause all processes within one or more containers\n\tps     \tList containers\n\tpull   \tPull an image or a repository from a registry\n\trename \tRename a container\n\trestart\tRestart one or more containers\n\trm     \tRemove one or more containers\n\trmi    \tRemove one or more images\n\trun    \tRun a command in a new container\n\tstart  \tStart one or more stopped containers\n\tstats  \tDisplay a live stream of container(s) resource usage statistics\n\tstop   \tStop one or more containers\n\ttag    \tCreate a tag TARGET_IMAGE that refers to SOURCE_IMAGE\n\ttop    \tDisplay the running processes of a container\n\tunpause\tUnpause all processes within one or more containers\n\tupdate \tUpdate configuration of one or more containers\n\tversion\tDisplay information about isula\n\twait   \tBlock until one or more containers stop, then print their exit codes\n")])])]),n("h3",{attrs:{id:"使用举例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用举例"}},[t._v("#")]),t._v(" 使用举例")]),t._v(" "),n("p",[t._v("假设您使用的为openeuler发行版本，可以采用以下方式使用iSulad。")]),t._v(" "),n("h4",{attrs:{id:"使用yum命令安装isulad"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用yum命令安装isulad"}},[t._v("#")]),t._v(" 使用yum命令安装isulad")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("[root@openeuler ~]# yum install -y iSulad\n")])])]),n("h4",{attrs:{id:"安装完成后-查看服务运行状态"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装完成后-查看服务运行状态"}},[t._v("#")]),t._v(" 安装完成后，查看服务运行状态")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("[root@openeuler ~]# systemctl status isulad\n● isulad.service - iSulad Application Container Engine\n   Loaded: loaded (/usr/lib/systemd/system/isulad.service; enabled; vendor preset: disabled)\n   Active: active (running) since Mon 2020-09-14 15:53:43 CST; 4h 35min ago\n Main PID: 1248 (isulad)\n    Tasks: 25\n   Memory: 88.3M\n   CGroup: /system.slice/isulad.service\n           ├─1248 /usr/bin/isulad\n")])])]),n("h4",{attrs:{id:"修改isulad的配置文件-添加镜像仓库地址"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#修改isulad的配置文件-添加镜像仓库地址"}},[t._v("#")]),t._v(" 修改isulad的配置文件，添加镜像仓库地址")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('[root@openeuler iSula]# vi /etc/isulad/daemon.json   \n{\n    .......\n    "registry-mirrors": [\n        "hub.oepkgs.net"\n    ],\n    .......\n')])])]),n("h4",{attrs:{id:"重启isulad服务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#重启isulad服务"}},[t._v("#")]),t._v(" 重启isulad服务")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("[root@openeuler iSula]# systemctl restart isulad\n")])])]),n("h4",{attrs:{id:"基于openeuler-20-09镜像运行容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#基于openeuler-20-09镜像运行容器"}},[t._v("#")]),t._v(" 基于openeuler:20.09镜像运行容器")]),t._v(" "),n("p",[t._v("创建容器：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('[root@openeuler iSula]# isula create -it openeuler/openeuler:20.09\nUnable to find image \'openeuler/openeuler:20.09\' locally\nImage "openeuler/openeuler:20.09" pulling\nImage "8c788f4bfb7290e434b2384340a5f9811db6ed302f9247c5fc095d6ec4fc8f32" pulled\ne91e5359be653f534312bc2b4703dcc6c4ca0436ac7819e09e1ff0e75ee1d733\n')])])]),n("p",[t._v("由于没有运行容器，所以利用isula ps命令无法找到刚刚创建的容器：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("[root@openeuler iSula]# isula ps\nCONTAINER ID\tIMAGE\t\t\t\tCOMMAND\tCREATED\t\tSTATUS\tPORTS\tNAMES\n")])])]),n("p",[t._v("可以使用isula pa –a命令可以找到刚刚创建的容器：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('[root@ecs-cdf3 ~]# isula ps -a\nCONTAINER ID\tIMAGE\t\t\t\tCOMMAND\tCREATED\t\tSTATUS\tPORTS\tNAMES\ne91e5359be65\t\topeneuler/openeuler:20.09\t"/bin/bash"\t\t8 seconds ago\tCreated\t e91e5359be653f534312bc2b4703dcc6c4ca0436ac7819e09e1ff0e75ee1d733\n')])])]),n("p",[t._v("启动容器：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("[root@openeuler iSula]# isula start e91e5359be65\n")])])]),n("p",[t._v("由于已经运行容器，可以利用isula ps命令查找运行中的容器")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('[root@openeuler iSula]# isula ps\nCONTAINER ID\tIMAGE\t\t\t\tCOMMAND\tCREATED\t\tSTATUS\tPORTS\tNAMES\ne91e5359be65\t\topeneuler/openeuler:20.09\t"/bin/bash"\t\t30 seconds ago\tUp 4 seconds\t     e91e5359be653f534312bc2b4703dcc6c4ca0436ac7819e09e1ff0e75ee1d733\n')])])]),n("p",[t._v("执行命令输出容器系统版本信息：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('[root@ecs-cdf3 ~]# isula exec e91e5359be65 cat /etc/os-release\nNAME="openEuler"\nVERSION="20.09"\nID="openEuler"\nVERSION_ID="20.09"\nPRETTY_NAME="openEuler 20.09"\nANSI_COLOR="0;31"\n')])])]),n("p",[t._v("可以看到我们在openeuler 20.03系统上成功运行openeuler 20.09容器。")]),t._v(" "),n("p",[t._v("暂停/恢复一个容器")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("[root@openeuler iSula]# isula pause e91e5359be65\ne91e5359be65\n[root@openeuler iSula]# isula unpause e91e5359be65\ne91e5359be65\n")])])]),n("p",[t._v("强制删除运行中的容器")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("[root@openeuler iSula]# isula rm -f 6c1d81467d33\n6c1d81467d3367a90dd6e388a16c80411d4ba76316d86b6f56463699306e1394\n")])])]),n("p",[t._v("删除镜像")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('[root@openeuler iSula]# isula rmi openeuler/openeuler:20.09\nImage " openeuler/openeuler:20.09" removed\n')])])]),n("h3",{attrs:{id:"支持-cri-标准协议"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#支持-cri-标准协议"}},[t._v("#")]),t._v(" 支持 CRI 标准协议")]),t._v(" "),n("p",[t._v("CRI(Container Runtime Interface)是由 K8S 定义的容器引擎需要向 k8S 对外提供的容器和镜像的服务的接口,供容器引擎接入 K8S。")]),t._v(" "),n("p",[t._v("CRI 接口基于 gRPC 实现。iSulad 遵循 CRI 接口规范，实现 CRI gRPC Server，包括 Runtime Service 和 Image Service 分别用来提供容器运行时接口和镜像操作接口。iSulad 的 gRPC Server 需要监听本地的 Unix socket，而 K8S 的组件 kubelet 则作为 gRPC Client 运行。")]),t._v(" "),n("img",{staticStyle:{zoom:"100%"},attrs:{src:a(1008),alt:"iSulad"}}),t._v(" "),n("h3",{attrs:{id:"支持-cni-网络标准协议"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#支持-cni-网络标准协议"}},[t._v("#")]),t._v(" 支持 CNI 网络标准协议")]),t._v(" "),n("p",[t._v("CNI(Container Network Interface) 是 google 和 CoreOS 主导制定的容器网络标准协议。通过 CNI 协议，iSulad 通过 JSON 格式的文件与具体网络插件进行通信，进而实现容器的网络功能。容器网络具体的功能均由网络插件来实现。iSulad 中使用 C 语言实现了 clibcni 接口模块，用来实现对应功能。")]),t._v(" "),n("img",{staticStyle:{zoom:"100%"},attrs:{src:a(1009),alt:"iSulad"}}),t._v(" "),n("h3",{attrs:{id:"遵循-oci-标准"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#遵循-oci-标准"}},[t._v("#")]),t._v(" 遵循 OCI 标准")]),t._v(" "),n("p",[t._v("OCI 包含两个标准规范 "),n("strong",[t._v("容器运行时标准 （runtime spec）和 容器镜像标准（image spec）")]),t._v("。")]),t._v(" "),n("h4",{attrs:{id:"支持-oci-标准镜像格式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#支持-oci-标准镜像格式"}},[t._v("#")]),t._v(" 支持 OCI 标准镜像格式")]),t._v(" "),n("p",[t._v("首先介绍下，什么是容器镜像。容器运行所需的 rootfs 以及一些资源配置等信息被打包成特定的数据结构，称为容器镜像。基于容器镜像可以方便地运行容器。由于运行环境和应用被一起打包到了容器镜像中，这样就解决了应用部署时的环境依赖问题。每个容器镜像由一个或多个层数据、以及一个 config.json 配置文件组成。多个层之间有依赖关系，这种依赖关系称为父子关系（被依赖的层为父层）。运行容器之前，所有层的数据会合并挂载成一个 rootfs 供容器使用，称为容器层。合并后的数据如果有冲突，则子层的数据会覆盖父层中路径名称都相同的数据，镜像组织结构如下图所示：")]),t._v(" "),n("img",{staticStyle:{zoom:"100%"},attrs:{src:a(1010),alt:"iSulad-img-single"}}),t._v(" "),n("p",[t._v("镜像的分层是为了解决空间占用问题。如果本层及其所有递归依赖的父层具有相同的数据，这些数据就可以复用，以减少空间占用。下图描述的是具有相同 layer0 层和 layer1 层的两个容器镜像的数据复用结构：")]),t._v(" "),n("img",{staticStyle:{zoom:"100%"},attrs:{src:a(1011),alt:"iSulad-img-dual"}}),t._v(" "),n("p",[t._v("iSulad 支持 OCI 标准镜像格式以及与 docker 兼容的镜像格式。能够 支持从 docker hub 等镜像仓库下载容器镜像，或者导入由 docker 导出的镜像文件来启动容器使用。")]),t._v(" "),n("h4",{attrs:{id:"支持-oci-标准-runtime"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#支持-oci-标准-runtime"}},[t._v("#")]),t._v(" 支持 OCI 标准 runtime")]),t._v(" "),n("p",[t._v("iSulad 支持标准 OCI runtime 操作接口，可以进行容器生命周期管理。iSulad 不仅支持当前主流的容器 runtime 如 runc、kata，而且针对低底噪的需求，将 C 语言编写的 lxc 进行了适配修改，使其能够作为支持 OCI 标准协议的 C 语言 runtime，进一步降低了容器引擎基础设施底噪开销。\n​ 下面使用 iSulad 来运行一个新的容器，通过查看运行过程中产生的进程以及持久化的配置，理解运行新容器的过程。")]),t._v(" "),n("p",[t._v("运行容器，首先需要下载镜像，我们使用 前文中提到的 openeuler/openeuler:20.09 来作为容器镜像。")]),t._v(" "),n("p",[t._v("调用 isula 客户端命令下载镜像。")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" isula pull openeuler/openeuler:20.09\nImage "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"openeuler/openeuler:20.09"')]),t._v(" pulling\nImage "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"c7c37e472d31c1685b48f7004fd6a64361c95965587a951692c5f298c6685998"')]),t._v(" pulled\n")])])]),n("p",[t._v("运行容器指创建一个新的容器，并启动它。")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" isula run -itd openeuler/openeuler:20.09\n42fc2595f876b5a18f7729dfb10d0def29789fb73fe0f1327e0277e6d85189a1\n")])])]),n("p",[t._v("运行容器后，可以通过本地文件查看持久化的容器配置文件。")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cd /var/lib/isulad/engines/lcr/42fc2595f876b5a18f7729dfb10d0def29789fb73fe0f1327e0277e6d85189a1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ls -al")]),t._v("\ntotal "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("92")]),t._v("\ndrwxr-x--- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" root root  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4096")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("27")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":25 "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\ndrwxr-x--- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" root root  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4096")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("27")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":25 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\n-rw-r----- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4045")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("27")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":25 config\n-rw-r----- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("23878")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("27")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":25 config.json\n-rw-r----- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2314")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("27")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":25 config.v2.json\n-rw-r----- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root     "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("27")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":25 console.log\n-rw-r----- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("101")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("27")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":25 hostconfig.json\n-rw-r--r-- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("27")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":25 "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("hostname")]),t._v("\n-rw-r--r-- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("183")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("27")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":25 hosts\ndrwx------ "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" root root  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4096")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("27")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":25 mounts\n-rw-r----- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root     "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("27")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":25 ocihooks.json\n-rw-r--r-- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("707")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("27")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":25 resolv.conf\n-rw-r----- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("26140")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("27")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":25 seccomp\n")])])]),n("p",[t._v("其中 config.json 文件为符合 OCI 标准协议的容器配置文件，内容包括启动容器所需的配置信息。")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat config.json")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ociVersion"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0.1"')]),t._v(",\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hooks"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hostname"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost"')]),t._v(",\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mounts"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"source"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tmpfs"')]),t._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"destination"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/dev"')]),t._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"options"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nosuid"')]),t._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"strictatime"')]),t._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mode=755"')]),t._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"size=65536k"')]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"type"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tmpfs"')]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"source"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mqueue"')]),t._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"destination"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/dev/mqueue"')]),t._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"options"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nosuid"')]),t._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"noexec"')]),t._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nodev"')]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"type"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mqueue"')]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])]),n("p",[t._v("config.v2.json 为 iSulad 维护管理容器持久化的一些信息,包括容器的基础配置，以及创建时间，启动时间，容器的 PID、运行启动时间等信息。")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat config.v2.json")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"CommonConfig"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Path"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sh"')]),t._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Config"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hostname"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost"')]),t._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"User"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Tty"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" true,\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"OpenStdin"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" true,\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Env"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"')]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Cmd"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sh"')]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"WorkingDir"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"LogDriver"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"json-file"')]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Created"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2020-07-27T16:25:16.170149428+08:00"')]),t._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Image"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"openeuler/openeuler:20.09"')]),t._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ImageType"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"oci"')]),t._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Name"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"42fc2595f876b5a18f7729dfb10d0def29789fb73fe0f1327e0277e6d85189a1"')]),t._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"42fc2595f876b5a18f7729dfb10d0def29789fb73fe0f1327e0277e6d85189a1"')]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Image"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sha256:c7c37e472d31c1685b48f7004fd6a64361c95965587a951692c5f298c6685998"')]),t._v(",\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"State"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"FinishedAt"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0001-01-01T00:00:00Z"')]),t._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Pid"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("19232")]),t._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PPid"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("19229")]),t._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"StartTime"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2731408")]),t._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PStartTime"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2731402")]),t._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Running"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" true,\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"StartedAt"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2020-07-27T16:25:16.286812971+08:00"')]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h2",{attrs:{id:"性能表现"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#性能表现"}},[t._v("#")]),t._v(" 性能表现")]),t._v(" "),n("h3",{attrs:{id:"与其他容器引擎性能比较"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#与其他容器引擎性能比较"}},[t._v("#")]),t._v(" 与其他容器引擎性能比较")]),t._v(" "),n("h4",{attrs:{id:"测试环境"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#测试环境"}},[t._v("#")]),t._v(" 测试环境")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("Configuration")]),t._v(" "),n("th",[t._v("Information")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("OS")]),t._v(" "),n("td",[t._v("Fedora32 X86_64")])]),t._v(" "),n("tr",[n("td",[t._v("kernel")]),t._v(" "),n("td",[t._v("linux 5.7.10-201.fc32.x86_64")])]),t._v(" "),n("tr",[n("td",[t._v("CPU")]),t._v(" "),n("td",[t._v("48 cores，Intel Xeon CPU E5-2695 v2 @ 2.4GHZ")])]),t._v(" "),n("tr",[n("td",[t._v("memory")]),t._v(" "),n("td",[t._v("132 GB")])])])]),t._v(" "),n("h4",{attrs:{id:"测试版本"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#测试版本"}},[t._v("#")]),t._v(" 测试版本")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("Name")]),t._v(" "),n("th",[t._v("Version")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("iSulad")]),t._v(" "),n("td",[t._v("Version: 2.0.3 , Git commit: 3bb24761f07cc0ac399e1cb783053db8b33b263d")])]),t._v(" "),n("tr",[n("td",[t._v("docker")]),t._v(" "),n("td",[t._v("Version: 19.03.11, Git commit: 42e35e6")])]),t._v(" "),n("tr",[n("td",[t._v("podman")]),t._v(" "),n("td",[t._v("version 2.0.3")])]),t._v(" "),n("tr",[n("td",[t._v("CRI-O")]),t._v(" "),n("td",[t._v("v1.15.4")])]),t._v(" "),n("tr",[n("td",[t._v("kubelet")]),t._v(" "),n("td",[t._v("v1.15.0")])]),t._v(" "),n("tr",[n("td",[t._v("cri-tools")]),t._v(" "),n("td",[t._v("v1.15.0")])])])]),t._v(" "),n("h4",{attrs:{id:"单容器操作"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#单容器操作"}},[t._v("#")]),t._v(" 单容器操作")]),t._v(" "),n("p",[t._v("使用客户端")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("operator (ms)")]),t._v(" "),n("th",[t._v("Docker")]),t._v(" "),n("th",[t._v("Podman")]),t._v(" "),n("th",[t._v("iSulad")]),t._v(" "),n("th",[t._v("vs Docker")]),t._v(" "),n("th",[t._v("vs Podman")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("create")]),t._v(" "),n("td",[t._v("287")]),t._v(" "),n("td",[t._v("180")]),t._v(" "),n("td",[t._v("87")]),t._v(" "),n("td",[t._v("-69.69%")]),t._v(" "),n("td",[t._v("-51.67%")])]),t._v(" "),n("tr",[n("td",[t._v("start")]),t._v(" "),n("td",[t._v("675")]),t._v(" "),n("td",[t._v("916")]),t._v(" "),n("td",[t._v("154")]),t._v(" "),n("td",[t._v("-77.19%")]),t._v(" "),n("td",[t._v("-83.19%")])]),t._v(" "),n("tr",[n("td",[t._v("stop")]),t._v(" "),n("td",[t._v("349")]),t._v(" "),n("td",[t._v("513")]),t._v(" "),n("td",[t._v("274")]),t._v(" "),n("td",[t._v("-21.49%")]),t._v(" "),n("td",[t._v("-46.59%")])]),t._v(" "),n("tr",[n("td",[t._v("rm")]),t._v(" "),n("td",[t._v("72")]),t._v(" "),n("td",[t._v("187")]),t._v(" "),n("td",[t._v("60")]),t._v(" "),n("td",[t._v("-16.67%")]),t._v(" "),n("td",[t._v("-67.91%")])]),t._v(" "),n("tr",[n("td",[t._v("run")]),t._v(" "),n("td",[t._v("866")]),t._v(" "),n("td",[t._v("454")]),t._v(" "),n("td",[t._v("195")]),t._v(" "),n("td",[t._v("-77.48%")]),t._v(" "),n("td",[t._v("-57.05%")])])])]),t._v(" "),n("p",[t._v("使用 CRI 接口")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("operator (ms)")]),t._v(" "),n("th",[t._v("Docker")]),t._v(" "),n("th",[t._v("CRIO")]),t._v(" "),n("th",[t._v("iSulad")]),t._v(" "),n("th",[t._v("vs Docker")]),t._v(" "),n("th",[t._v("vs Podman")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("runp")]),t._v(" "),n("td",[t._v("681")]),t._v(" "),n("td",[t._v("321")]),t._v(" "),n("td",[t._v("186")]),t._v(" "),n("td",[t._v("-72.69%")]),t._v(" "),n("td",[t._v("-42.06%")])]),t._v(" "),n("tr",[n("td",[t._v("stopp")]),t._v(" "),n("td",[t._v("400")]),t._v(" "),n("td",[t._v("356")]),t._v(" "),n("td",[t._v("169")]),t._v(" "),n("td",[t._v("-57.75%")]),t._v(" "),n("td",[t._v("-52.53%")])])])]),t._v(" "),n("h4",{attrs:{id:"并发-100-容器操作"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#并发-100-容器操作"}},[t._v("#")]),t._v(" 并发 100 容器操作")]),t._v(" "),n("p",[t._v("使用客户端")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("operator (ms)")]),t._v(" "),n("th",[t._v("Docker")]),t._v(" "),n("th",[t._v("Podman")]),t._v(" "),n("th",[t._v("iSulad")]),t._v(" "),n("th",[t._v("vs Docker")]),t._v(" "),n("th",[t._v("vs Podman")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("100 * create")]),t._v(" "),n("td",[t._v("4995")]),t._v(" "),n("td",[t._v("3993")]),t._v(" "),n("td",[t._v("829")]),t._v(" "),n("td",[t._v("-83.40%")]),t._v(" "),n("td",[t._v("-79.24%")])]),t._v(" "),n("tr",[n("td",[t._v("100 * start")]),t._v(" "),n("td",[t._v("10126")]),t._v(" "),n("td",[t._v("5537")]),t._v(" "),n("td",[t._v("1425")]),t._v(" "),n("td",[t._v("-85.93%")]),t._v(" "),n("td",[t._v("-74.26%")])]),t._v(" "),n("tr",[n("td",[t._v("100 * stop")]),t._v(" "),n("td",[t._v("8066")]),t._v(" "),n("td",[t._v("11100")]),t._v(" "),n("td",[t._v("2273")]),t._v(" "),n("td",[t._v("-71.82%")]),t._v(" "),n("td",[t._v("-79.52%")])]),t._v(" "),n("tr",[n("td",[t._v("100 * rm")]),t._v(" "),n("td",[t._v("3220")]),t._v(" "),n("td",[t._v("4319")]),t._v(" "),n("td",[t._v("438")]),t._v(" "),n("td",[t._v("-86.40%")]),t._v(" "),n("td",[t._v("-89.86%")])]),t._v(" "),n("tr",[n("td",[t._v("100 * run")]),t._v(" "),n("td",[t._v("9822")]),t._v(" "),n("td",[t._v("5979")]),t._v(" "),n("td",[t._v("2117")]),t._v(" "),n("td",[t._v("-78.45%")]),t._v(" "),n("td",[t._v("-64.59%")])])])]),t._v(" "),n("p",[t._v("使用 CRI 接口")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("operator (ms)")]),t._v(" "),n("th",[t._v("Docker")]),t._v(" "),n("th",[t._v("CRIO")]),t._v(" "),n("th",[t._v("iSulad")]),t._v(" "),n("th",[t._v("vs Docker")]),t._v(" "),n("th",[t._v("vs Podman")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("100 * runp")]),t._v(" "),n("td",[t._v("13998")]),t._v(" "),n("td",[t._v("4946")]),t._v(" "),n("td",[t._v("2825")]),t._v(" "),n("td",[t._v("-79.82%")]),t._v(" "),n("td",[t._v("-42.88%")])]),t._v(" "),n("tr",[n("td",[t._v("100 * stopp")]),t._v(" "),n("td",[t._v("8402")]),t._v(" "),n("td",[t._v("4834")]),t._v(" "),n("td",[t._v("4543")]),t._v(" "),n("td",[t._v("-45.93%")]),t._v(" "),n("td",[t._v("-6.02%")])])])]),t._v(" "),n("h2",{attrs:{id:"isulad-代码架构介绍"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#isulad-代码架构介绍"}},[t._v("#")]),t._v(" iSulad 代码架构介绍")]),t._v(" "),n("p",[t._v("前面介绍了 iSulad 的主要的功能特性，现在让我们深入到 iSulad 的代码中，了解下 iSulad 的代码组织架构。")]),t._v(" "),n("h3",{attrs:{id:"ddd-分层架构设计"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ddd-分层架构设计"}},[t._v("#")]),t._v(" "),n("strong",[t._v("DDD 分层架构设计")])]),t._v(" "),n("p",[t._v("iSulad 采用 DDD（Domain Driven Design，领域驱动设计）的思想进行架构分层组织，层次划分如下：")]),t._v(" "),n("img",{staticStyle:{zoom:"100%"},attrs:{src:a(1012),alt:"ddd"}}),t._v(" "),n("p",[t._v("各逻辑分层划分以及对应的职责如下：")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[n("strong",[t._v("层次")])]),t._v(" "),n("th",[n("strong",[t._v("职责划分")])])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("用户界面")]),t._v(" "),n("td",[t._v("负责向用户展现信息以及解释用户命令")])]),t._v(" "),n("tr",[n("td",[t._v("接口层")]),t._v(" "),n("td",[t._v("客户端服务端通信接口、CRI 接口的定义与实现")])]),t._v(" "),n("tr",[n("td",[t._v("应用层")]),t._v(" "),n("td",[t._v("调用领域层的接口，实现对应的业务应用")])]),t._v(" "),n("tr",[n("td",[t._v("领域层")]),t._v(" "),n("td",[t._v("本层包含关于领域的信息，这是 iSulad 软件的核心所在。包含多种模块，业务逻辑实际的执行层")])]),t._v(" "),n("tr",[n("td",[t._v("基础设施层")]),t._v(" "),n("td",[t._v("本层作为其他层的支撑库。它提供各种工具函数供其他层次调用使用")])])])]),t._v(" "),n("p",[t._v("根据上述逻辑分层的设计思想，iSulad 对应源码目录架构设计为:")]),t._v(" "),n("img",{staticStyle:{zoom:"100%"},attrs:{src:a(1013),alt:"iSulad-img-single"}}),t._v(" "),n("p",[t._v("其中 api 目录中定义了 iSulad 对外提供的 gRPC 服务的 proto 文件，在编译时会使用 grpc 生成对应客户端、服务端代码。")]),t._v(" "),n("h3",{attrs:{id:"各层代码组织结构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#各层代码组织结构"}},[t._v("#")]),t._v(" 各层代码组织结构")]),t._v(" "),n("h4",{attrs:{id:"用户界面层"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#用户界面层"}},[t._v("#")]),t._v(" 用户界面层")]),t._v(" "),n("p",[t._v("用户界面层的代码位于 src/cmd 目录下，在该目录下，提供了 iSulad 对外的命令行接口。在 cmd 目录下，提供了 isula 客户端、isulad 服务端、isulad-shim 三个命令行相关的命令行解析、参数显示。代码组织结构如下：")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("├── CMakeLists.txt\n├── command_parser.c\n├── command_parser.h\n├── isula "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 客户端命令行以及子命令的定义")]),t._v("\n│   ├── base "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 容器操作基础命令，如创建、启动、删除等命令")]),t._v("\n│   ├── client_arguments.c\n│   ├── client_arguments.h\n│   ├── CMakeLists.txt\n│   ├── extend  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 容器操作扩展命令，如update更新容器资源、events查看容器事件日志")]),t._v("\n│   ├── images "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 镜像相关操作命令，如下载、导入、删除等操作")]),t._v("\n│   ├── information "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查询容器信息操作命令，如inspect、info等操作")]),t._v("\n│   ├── isula_commands.c\n│   ├── isula_commands.h\n│   ├── main.c\n│   └── stream  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 长连接命令，如cp、attach、exec等需要与服务端进行长连接操作的命令")]),t._v("\n├── isulad "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 服务端命令行以及参数的定义")]),t._v("\n│   ├── CMakeLists.txt\n│   ├── isulad_commands.c\n│   ├── isulad_commands.h\n│   └── main.c\n└── isulad-shim "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# isulad-shim命令行以及参数的定义")]),t._v("\n│   ├── CMakeLists.txt\n│   ├── common.c\n│   ├── common.h\n│   ├── main.c\n│   ├── process.c\n│   ├── process.h\n│   ├── terminal.c\n│   └── terminal.h\n└── options "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 通用的参数解析方法")]),t._v("\n│   ├── CMakeLists.txt\n│   ├── opt_log.c\n│   ├── opt_log.h\n│   ├── opt_ulimit.c\n│   └── opt_ulimit.h\n\n\n")])])]),n("h4",{attrs:{id:"接口层"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#接口层"}},[t._v("#")]),t._v(" 接口层")]),t._v(" "),n("p",[t._v("iSulad 的接口层代码位于 src/daemon/entry 目录，其中提供了客户端服务端通信接口、CRI 接口的定义。")]),t._v(" "),n("p",[t._v("用以处理客户端接口的请求以及 CRI 接口请求。")]),t._v(" "),n("p",[t._v("其中 CRI 接口处理中，可以从文件名中看到，iSulad 分别实现了 image 和 runtime 的两种 service。")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("├── CMakeLists.txt\n├── connect "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 处理客户端请求")]),t._v("\n│   ├── CMakeLists.txt\n│   ├── grpc "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# grpc 请求接口处理")]),t._v("\n│   ├── rest "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# restful 请求接口处理")]),t._v("\n│   ├── service_common.c\n│   └── service_common.h\n└── cri  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 处理CRI接口请求")]),t._v("\n    ├── checkpoint_handler.cc\n    ├── checkpoint_handler.h\n    ├── CMakeLists.txt\n    ├── cni_network_plugin.cc\n    ├── cni_network_plugin.h\n    ├── cri_container.cc "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cri接口中容器相关操作请求接口处理")]),t._v("\n    ├── cri_container.h\n    ├── cri_image_service.cc "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cri接口中image相关操作请求接口处理")]),t._v("\n    ├── cri_image_service.h\n    ├── cri_runtime_service.cc  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cri接口中runtime相关操作请求接口处理")]),t._v("\n    ├── cri_runtime_service.h\n    ├── cri_sandbox.cc "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cri接口中pod相关操作请求接口处理")]),t._v("\n    ├── cri_sandbox.h\n    ├── cri_security_context.cc "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cri接口中安全配置处理")]),t._v("\n    ├── cri_security_context.h\n    └── websocket  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 使用websocket服务处理CRI 流式服务请求")]),t._v("\n")])])]),n("h4",{attrs:{id:"应用层"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#应用层"}},[t._v("#")]),t._v(" 应用层")]),t._v(" "),n("p",[t._v("iSulad 的应用层代码位于 src/daemon/executor 目录，其作用为调用领域层的接口，实现对应的业务应用，属于业务调度层。可以从文件夹的命名中看到，应用层分别实现了 image 和 runtime 的两种业务模块。")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("├── callback.c\n├── callback.h\n├── CMakeLists.txt\n├── container_cb "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 容器业务模块")]),t._v("\n│   ├── CMakeLists.txt\n│   ├── execution.c\n│   ├── execution_create.c\n│   ├── execution_create.h\n│   ├── execution_extend.c\n│   ├── execution_extend.h\n│   ├── execution.h\n│   ├── execution_information.c\n│   ├── execution_information.h\n│   ├── execution_network.c\n│   ├── execution_network.h\n│   ├── execution_stream.c\n│   ├── execution_stream.h\n│   ├── list.c\n│   └── list.h\n└── image_cb "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 镜像业务模块")]),t._v("\n    ├── CMakeLists.txt\n    ├── image_cb.c\n    └── image_cb.h\n")])])]),n("h4",{attrs:{id:"领域层"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#领域层"}},[t._v("#")]),t._v(" 领域层")]),t._v(" "),n("p",[t._v("领域层包含领域的信息，这是 iSulad 软件的核心所在。其中包含各个业务模块，是业务逻辑实际的执行层。领域层代码位于 src/daemon/modules。")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("├── api "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 领域层统一对外提供的头文件，供应用层调用")]),t._v("\n│   ├── CMakeLists.txt\n│   ├── container_api.h\n│   ├── events_collector_api.h\n│   ├── events_sender_api.h\n│   ├── event_type.h\n│   ├── image_api.h\n│   ├── io_handler.h\n│   ├── log_gather_api.h\n│   ├── plugin_api.h\n│   ├── runtime_api.h\n│   ├── service_container_api.h\n│   ├── service_image_api.h\n│   └── specs_api.h\n├── CMakeLists.txt\n├── container "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 容器模块，维护容器全生命周期，维护容器状态")]),t._v("\n│   ├── CMakeLists.txt\n│   ├── container_events_handler.c\n│   ├── container_events_handler.h\n│   ├── container_gc\n│   ├── containers_store.c\n│   ├── containers_store.h\n│   ├── container_state.c\n│   ├── container_state.h\n│   ├── container_unix.c\n│   ├── container_unix.h\n│   ├── health_check\n│   ├── restart_manager\n│   ├── restore\n│   └── supervisor\n├── events "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 事件收集模块，负责收集iSulad运行过程中产生的容器、镜像事件")]),t._v("\n│   ├── CMakeLists.txt\n│   ├── collector.c\n│   ├── monitord.c\n│   └── monitord.h\n├── events_sender  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 事件发送模块，该接口提供向事件收集模块发送事件的接口")]),t._v("\n│   ├── CMakeLists.txt\n│   └── event_sender.c\n├── image "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 镜像管理模块")]),t._v("\n│   ├── CMakeLists.txt\n│   ├── embedded "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# embedded格式镜像管理")]),t._v("\n│   ├── external "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# external格式镜像管理")]),t._v("\n│   ├── image.c\n│   ├── image_rootfs_handler.c\n│   ├── image_rootfs_handler.h\n│   └── oci\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# oci格式镜像管理")]),t._v("\n├── log "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 日志收集模块")]),t._v("\n│   ├── CMakeLists.txt\n│   └── log_gather.c\n├── plugin "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 插件机制模块")]),t._v("\n│   ├── CMakeLists.txt\n│   ├── plugin.c\n│   ├── pspec.c\n│   └── pspec.h\n├── runtime "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 容器运行时模块")]),t._v("\n│   ├── CMakeLists.txt\n│   ├── engines "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 基于lxc的轻量级runtime对接接口")]),t._v("\n│   ├── isula "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# oci 标准runtime对接接口")]),t._v("\n│   └── runtime.c\n├── "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 服务模块，包含多个模块协同调用的实现")]),t._v("\n│   ├── CMakeLists.txt\n│   ├── io_handler.c\n│   ├── service_container.c "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 容器服务操作接口")]),t._v("\n│   └── service_image.c  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 镜像服务操作接口")]),t._v("\n└── spec  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# oci规范配置模块，对外提供OCI spec合并、校验等功能接口")]),t._v("\n    ├── CMakeLists.txt\n    ├── specs.c\n    ├── specs_extend.c\n    ├── specs_extend.h\n    ├── specs_mount.c\n    ├── specs_mount.h\n    ├── specs_namespace.c\n    ├── specs_namespace.h\n    ├── specs_security.c\n    ├── specs_security.h\n    ├── verify.c  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置校验功能接口")]),t._v("\n    └── verify.h\n")])])]),n("h4",{attrs:{id:"基础设施层"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#基础设施层"}},[t._v("#")]),t._v(" 基础设施层")]),t._v(" "),n("p",[t._v("基础设施层位于 src/utils 目录下，本层作为其他层的支撑库。它提供各种工具函数供其他层次调用使用：")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("├── buffer "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# buffer 工具函数")]),t._v("\n│   ├── buffer.c\n│   ├── buffer.h\n│   └── CMakeLists.txt\n├── CMakeLists.txt\n├── console "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# IO 终端处理工具函数")]),t._v("\n│   ├── CMakeLists.txt\n│   ├── console.c\n│   └── console.h\n├── cpputils "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# C++ 使用到的工具函数，包含基础字符串处理、url、线程工具")]),t._v("\n│   ├── CMakeLists.txt\n│   ├── cxxutils.cc\n│   ├── cxxutils.h\n│   ├── stoppable_thread.cc\n│   ├── stoppable_thread.h\n│   ├── url.cc\n│   └── url.h\n├── cutils "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# C使用到的工具函数，包含基础字符串处理、数据类型转换、文件处理、正则表达式等工具函数")]),t._v("\n│   ├── CMakeLists.txt\n│   ├── util_atomic.c\n│   ├── util_atomic.h\n│   ├── utils_aes.c\n│   ├── utils_aes.h\n│   ├── utils_array.c\n│   ├── utils_array.h\n│   ├── utils_base64.c\n│   ├── utils_base64.h\n│   ├── utils.c\n│\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\n├── http "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# http 处理工具函数，包含http请求、解析、认证等工具")]),t._v("\n│   ├── certificate.c\n│   ├── certificate.h\n│   ├── CMakeLists.txt\n│   ├── http.c\n│   ├── http.h\n│   ├── mediatype.h\n│   ├── parser.c\n│   ├── parser.h\n│   ├── rest_common.c\n│   └── rest_common.h\n├── sha256 "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# sha256 工具函数，用来计算sha256")]),t._v("\n│   ├── CMakeLists.txt\n│   ├── sha256.c\n│   └── sha256.h\n└── "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 压缩、解压工具函数，用来压缩、解压文件")]),t._v("\n    ├── CMakeLists.txt\n    ├── isulad_tar.c\n    ├── isulad_tar.h\n    ├── util_archive.c\n    ├── util_archive.h\n    ├── util_gzip.c\n    └── util_gzip.h\n")])])]),n("h3",{attrs:{id:"调用流程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#调用流程"}},[t._v("#")]),t._v(" 调用流程")]),t._v(" "),n("p",[t._v("可以借助"),n("strong",[t._v("Structure101")]),t._v(" 代码分析工具，梳理出 iSulad 各个代码目录之前的调用依赖关系。")]),t._v(" "),n("img",{staticStyle:{zoom:"100%"},attrs:{src:a(1014),alt:"iSulad"}}),t._v(" "),n("p",[t._v("首先，用户界面层（cmd）作为上层，仅会调用其他模块的接口，不会被其他模块所依赖。cmd 会调用 client 目录中的函数，与 daemon 端进行通信。由于 cmd 目录中存在 iSulad daemon 的命令行接口，因此会依赖 daemon 目录下的函数定义。")]),t._v(" "),n("p",[t._v("daemon 目录作为服务端代码的顶层目录，其中包含接口层（entry）、应用层（executor）、领域层（modules）的代码。接口层作为调用 daemon 服务的入口，需要调用其他层中的函数进行业务调度处理，而不会被其他层次所依赖。应用层需要调用领域层（modules）中各个模块的接口来实现具体的业务。")]),t._v(" "),n("p",[t._v("modules 目录作为 iSulad 的核心领域层代码，包含各个子功能模块的具体实现。以 image 模块为例，首先在 src/daemon/modules/api 中提供了 image_api.h，屏蔽了各种不同镜像格式的差异，对外提供统一的 image 操作函数接口。")]),t._v(" "),n("div",{staticClass:"language-c extra-class"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("image_module_init")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" isulad_daemon_configs "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("image_module_exit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("im_list_images")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" im_list_request "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" im_list_response "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("im_rm_image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" im_rmi_request "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" im_remove_response "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("im_tag_image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" im_tag_request "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" im_tag_response "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("im_inspect_image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" im_inspect_request "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" im_inspect_response "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("im_import_image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" im_import_request "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("im_load_image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" im_load_request "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" im_load_response "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("im_pull_image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" im_pull_request "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" im_pull_response "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("im_get_image_type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("image"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("external_rootfs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nbool "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("im_config_image_exist")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("image_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("im_login")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" im_login_request "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" im_login_response "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("im_logout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" im_logout_request "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" im_logout_response "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("im_container_export")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" im_export_request "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("free_im_export_request")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("im_export_request "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("ptr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])]),n("p",[t._v("在镜像管理模块内部，对不同格式的镜像操作进行区分。")]),t._v(" "),n("div",{staticClass:"language-c extra-class"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("bim_type")]),t._v(" g_bims"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token macro property"}},[n("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),n("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("ifdef")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token expression"}},[t._v("ENABLE_OCI_IMAGE")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("image_type "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" IMAGE_TYPE_OCI"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ops "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("g_oci_ops"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token macro property"}},[n("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),n("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("endif")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("image_type "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" IMAGE_TYPE_EXTERNAL"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ops "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("g_ext_ops "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token macro property"}},[n("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),n("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("ifdef")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token expression"}},[t._v("ENABLE_EMBEDDED_IMAGE")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("image_type "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" IMAGE_TYPE_EMBEDDED"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ops "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("g_embedded_ops "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token macro property"}},[n("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),n("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("endif")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("其他模块也都是类似的设计，具体深入到不同模块的详细解析，在后续的博客中会一一进行分析。")])])}),[],!1,null,null,null);s.default=e.exports}}]);